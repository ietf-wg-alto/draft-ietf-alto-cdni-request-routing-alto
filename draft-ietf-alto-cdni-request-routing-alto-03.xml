<?xml version="1.0"  encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "http://http://tools.ietf.org/tools/templates/rfc2629.dtd">
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc iprnotified="no" ?>
<?rfc symrefs="yes"?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc category="std"
     docName="draft-ietf-alto-cdni-request-routing-alto-03"
     ipr="trust200902">
  <front>
    <title abbrev="CDNI FCI using ALTO">Content Delivery Network Interconnection (CDNI) Request Routing:
      CDNI Footprint and Capabilities Advertisement using ALTO</title>

    <author initials="J." surname="Seedorf" fullname="Jan Seedorf">
      <organization abbrev="HFT Stuttgart - Univ. of Applied Sciences">HFT Stuttgart - Univ. of Applied Sciences</organization>
      <address>
        <postal>
               <street>Schellingstrasse 24</street>
               <city>Stuttgart</city>
               <code>70174</code>
               <country>Germany</country>
        </postal>
        <phone>+49-0711-8926-2801</phone>
        <email>jan.seedorf@hft-stuttgart.de</email>
      </address>
    </author>

    <author initials="Y." surname="Yang" fullname="Y.R. Yang">
         <organization abbrev="Tongji/Yale">Tongji/Yale University</organization>
         <address>
            <postal>
               <street>51 Prospect Street</street>
               <city>New Haven, CT</city>
               <code>06511</code>
               <country>United States of America</country>
            </postal>
            <email>yry@cs.yale.edu</email>
            <uri>http://www.cs.yale.edu/~yry/</uri>
         </address>
    </author>

    <author initials="K." surname="Ma" fullname="Kevin J. Ma">
      <organization abbrev="Ericsson">Ericsson</organization>
      <address>
        <postal>
               <street>43 Nagog Park</street>
               <city>Acton, MA</city>
               <code>01720</code>
               <country>United States of America</country>
        </postal>
        <phone>+1-978-844-5100</phone>
        <email>kevin.j.ma@ericsson.com</email>
      </address>
    </author>

    <author fullname="Jon Peterson" initials="J." surname="Peterson">
      <organization abbrev="Neustar">NeuStar</organization>
      <address>
        <postal>
          <street>1800 Sutter St Suite 570</street>
          <code>94520</code>
          <city>Concord, CA</city>
          <country>United States of America</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>jon.peterson@neustar.biz</email>
      </address>
    </author>

    <author initials="X." surname="Lin" fullname="X.S. Lin">
         <organization abbrev="Tongji">Tongji University</organization>
         <address>
            <postal>
               <street>4800 Cao'an Hwy</street>
               <city>Shanghai</city>
               <code>201804</code>
               <country>China</country>
            </postal>
            <email>x.shawn.lin@gmail.com</email>
         </address>
    </author>
    <date />

    <area>TSV Area</area>

    <workgroup>CDNI</workgroup>
    <keyword>ALTO</keyword>
    <keyword>CDNi</keyword>

    <abstract>
      <t>The Content Delivery Networks Interconnection (CDNI) WG is
        defining a set of protocols to inter-connect CDNs, to achieve multiple goals such as extending the reach of a given CDN to areas that are not covered by that particular CDN. One component that is needed to achieve the goal of CDNI is the CDNI Request Routing Footprint &amp; Capabilities Advertisement interface (FCI) [RFC7336]. [RFC8008] has defined precisely the semantics of FCI and provided guidelines on the FCI protocol, but the exact protocol is explicitly outside the scope of that document. In this document, we define an FCI protocol using the Application-Layer Traffic Optimization (ALTO) protocol.
      </t>
    </abstract>

  </front>

  <middle>

    <section anchor="intro" title="Introduction">
      <t>Many Network Service Providers (NSPs) are currently considering or have already started to deploy Content Delivery Networks (CDNs) within their networks. As a consequence of this development, there is a need for interconnecting these local CDNs. Content Delivery Networks Interconnection (CDNI) has the goal of standardizing protocols to enable such interconnection of CDNs <xref target="RFC6707" pageno="false" format="default"/>.</t>

      <t>The CDNI problem statement <xref target="RFC6707" pageno="false" format="default"/> defines four interfaces to be standardized within the IETF for CDN interconnection:
        <list style="symbols">
               <t>CDNI Request Routing Interface</t>
               <t>CDNI Metadata Interface</t>
               <t>CDNI Logging Interface</t>
               <t>CDNI Control Interface</t>
        </list>
      </t>

      <t>The main purpose of the CDNI Request Routing Interface is described in <xref target="RFC6707" pageno="false" format="default"/> as follows: "The CDNI Request Routing interface enables a Request Routing function in an Upstream CDN to query a Request Routing function in a Downstream CDN to determine if the Downstream CDN is able (and willing) to accept the delegated Content Request.  It also allows the Downstream CDN to control what should be returned to the User Agent in the redirection message by the upstream Request Routing function." On a high level, the scope of the CDNI Request Routing Interface, therefore, contains two main tasks:
      <list style="symbols">
        <t>determining if the downstream CDN (dCDN) is willing to accept a delegated content request;</t>
        <t>redirecting the content request coming from an upstream CDN (uCDN) to the proper entry point or entity in the downstream CDN.</t>
      </list>
      </t>

      <t>Correspondingly, the request routing interface is broadly divided into two functionalities:
      <list style="symbols">
        <t>CDNI Footprint &amp; Capabilities Advertisement interface (FCI): the advertisement from a dCDN to a uCDN or a query from a uCDN to a dCDN for the uCDN to decide whether to redirect particular user requests to that dCDN;</t>
        <t>CDNI Request Routing Redirection interface (RI): the synchronous operation of actually redirecting a user request.</t>
      </list>
      </t>

      <t>This document focuses solely on CDNI FCI, with a goal to specify a new Application-Layer Traffic Optimization (ALTO) <xref target="RFC7285" pageno="false" format="default"/> service called "CDNI FCI Map Service", to transport and update CDNI FCI objects, which are defined in a separate document in <xref target="RFC8008"/> and to describe approaches for filtering CDNI FCI map on capabilities or footprints. 
      </t>

      <t>Throughout this document, we use the terminology for CDNI defined in <xref target="RFC6707" pageno="false" format="default"/> and <xref target="RFC8008" pageno="false" format="default"/>.
        </t>
    </section>

    <section anchor="background" title="Background">
      <t>The design of CDNI FCI transport using ALTO depends on the understanding of both FCI semantics and ALTO. Hence, we start with a review of both.
      </t>

      <section title="Semantics of FCI Advertisement" anchor="bgSemantics">
        <t>The CDNI document on "Footprint and Capabilities Semantics" <xref target="RFC8008"/> defines the semantics for the CDNI FCI. It thus provides guidance on what Footprint and Capabilities mean in a CDNI context and how a protocol solution should in principle look like. The definitions in [RFC8008] depend on [RFC8006]. Here we briefly summarize key related points of [RFC8008] and [RFC8006]. For a detailed discussion, the reader is referred to the RFCs.
        </t>

        <t><list style="symbols">
          <t>Footprint and capabilities are tied together and cannot be interpreted independently from each other. In such cases, i.e., where capabilities must be expressed on a per footprint basis, it may be beneficial to combine footprint and capabilities advertisement. [RFC8008] integrates footprint and capabilities with an approach of "capabilities with footprint restrictions".</t>

          <t>Given that a large part of Footprint and Capabilities Advertisement will actually happen in contractual agreements, the semantics of CDNI Footprint and Capabilities advertisement refers to answering the following question: what exactly still needs to be advertised by the CDNI FCI? For instance, updates about temporal failures of part of a footprint can be useful information to convey via the CDNI request routing interface. Such information would provide updates on information previously agreed in contracts between the participating CDNs. In other words, the CDNI FCI is a means for a dCDN to provide changes/updates regarding a footprint and/or capabilities it has prior agreed to serve in a contract with a uCDN. Hence, server push and incremental encoding will be necessary techniques.</t>

          <t>Multiple types of footprints are defined in <xref target="RFC8006"/>:
            <list style="symbols">
              <t>List of ISO Country Codes</t>
              <t>List of AS numbers</t>
              <t>Set of IP-prefixes</t>
            </list>
          A "set of IP-prefixes" must be able to contain full IP addresses, i.e., a /32 for IPv4 and a /128 for IPv6, and also IP prefixes with an arbitrary prefix length. There must also be support for multiple IP address versions, i.e., IPv4 and IPv6, in such a footprint.
          </t>

          <t>For all of these mandatory-to-implement footprint types, footprints can be viewed as constraints for delegating requests to a dCDN: A dCDN footprint advertisement tells the uCDN the limitations for delegating a request to the dCDN. For IP prefixes or ASN(s), the footprint signals to the uCDN that it should consider the dCDN a candidate only if the IP address of the request routing source falls within the prefix set (or ASN, respectively). The CDNI specifications do not define how a given uCDN determines what address ranges are in a particular ASN. Similarly, for country codes, a uCDN should only consider the dCDN a candidate if it covers the country of the request routing source. The CDNI specifications do not define how a given uCDN determines the country of the request routing source. Multiple footprint constraints are additive, i.e., the advertisement of different types of footprint narrows the dCDN candidacy cumulatively.
          </t>

          <t>The following capabilities are defined as "base" capabilities, i.e., ones that are needed in any case and therefore constitute mandatory capabilities to be supported by the CDNI FCI:
          <list style="symbols">
            <t>Delivery Protocol (e.g., HTTP vs. RTMP)</t>
            <t>Acquisition Protocol (for acquiring content from a uCDN)</t>
            <t>Redirection Mode (e.g., DNS Redirection vs. HTTP Redirection as discussed in <xref target="RFC7336" pageno="false" format="default"/>)</t>
            <t>Capabilities related to CDNI Logging (e.g., supported logging mechanisms)</t>
            <t>Capabilities related to CDNI Metadata (e.g., authorization
            algorithms or support for proprietary vendor metadata)</t>
          </list>
          </t>
        </list></t>
      </section> <!-- Background on semantics -->

      <section anchor="bgALTO" title="ALTO Background and Benefits">
        <t>Application-Layer Traffic Optimization (ALTO) <xref target="RFC7285" pageno="false" format="default"/> is an approach for guiding the resource provider selection process in distributed applications that can choose among several candidate resources providers to retrieve a given resource. By conveying network layer (topology) information, an ALTO server can provide important information to "guide" the resource provider selection process in distributed applications. Usually, it is assumed that an ALTO server conveys information these applications cannot measure themselves <xref target="RFC5693" pageno="false" format="default"/>.
        </t>

        <t>
         Originally, ALTO was motivated by the huge amount of cross-ISP traffic generated by P2P applications <xref target="RFC5693" pageno="false" format="default"/>. Recently, however, ALTO is also being considered for improving the request routing in CDNs <xref target="I-D.jenkins-alto-cdn-use-cases"/>. In this context, it has also been proposed to use ALTO for selecting an entry-point in a downstream NSP's network (see section 3.4 "CDN delivering Over-The-Top of a NSP's network" in <xref target="I-D.jenkins-alto-cdn-use-cases"/>). Also, the CDNI problem statement explicitly mentions ALTO as a candidate protocol for "actual algorithms for selection of CDN or Surrogate by Request-Routing systems" <xref target="RFC6707" pageno="false" format="default"/>.
        </t>

        <t>The following reasons make ALTO a suitable candidate protocol for downstream CDN selection as part of CDNI request routing and in particular for an FCI protocol:</t>

        <t><list style="symbols">
          <t>CDN request routing is done at the application layer. ALTO is a protocol specifically designed to improve application layer traffic (and application layer connections among hosts on the Internet) by providing additional information to applications that these applications could not easily retrieve themselves. For CDNI, this is exactly the case: a uCDN wants to improve application layer CDN request routing by using dedicated information (provided by a dCDN) that the uCDN could not easily obtain otherwise.</t>

          <t>The semantics of an ALTO network map is an exact match for the needed information to convey a footprint by a downstream CDN, in particular if such a footprint is being expressed by IP-prefix ranges.</t>
          <t>Security: ALTO maps can be signed and hence provide inherent integrity protection (see <xref target="security"/>).</t>

          <t>RESTful-Design: The ALTO protocol has undergone extensive revisions in order to provide a RESTful design regarding the client-server interaction specified by the protocol. A CDNI FCI interface based on ALTO would inherit this RESTful design.</t>

          <t>Error-handling: The ALTO protocol has undergone extensive revisions in order to provide sophisticated error-handling, in particular regarding unexpected cases. A CDNI FCI interface based on ALTO would inherit this thought-through and mature error-handling.</t>

          <t>Filtered network map: The ALTO Map Filtering Service (see <xref target="RFC7285" pageno="false" format="default"/> for details) would allow a uCDN to query only for parts of an ALTO map.
          </t>

          <t>Server-initiated Notifications and Incremental Updates: In case the footprint or the capabilities of a downstream CDN change abruptly (i.e., unexpectedly from the perspective of an upstream CDN), server-initiated  notifications would enable a dCDN to directly inform an upstream CDN about such changes. Consider the case where - due to failure - part of the footprint of the dCDN is not functioning, i.e., the CDN cannot serve content to such clients with reasonable QoS. Without server-initiated notifications, the uCDN might still use a very recent network and cost map from dCDN, and therefore redirect requests to dCDN which it cannot serve. Similarly, the possibility for incremental updates would enable efficient conveyance of the aforementioned (or similar) status changes by the dCDN to the uCDN. The newest design of ALTO supports server pushed incremental updates <xref target="I-D.ietf-alto-incr-update-sse"/>. </t>

          <t>Content Availability on Hosts: A dCDN might want to express CDN capabilities in terms of certain content types (e.g., codecs/formats, or content from certain content providers). The new endpoint property for ALTO would enable a dCDN to make such information available to an upstream CDN. This would enable a uCDN to determine if a given dCDN actually has the capabilities for a given request with respect to the type of content requested.</t>

          <t>Resource Availability on Hosts or Links: The capabilities on links (e.g. maximum bandwidth) or caches (e.g. average load) might be useful information for an upstream CDN for optimized downstream CDN selection. For instance, if a uCDN receives a streaming request for content with a certain bitrate, it needs to know if it is likely that a dCDN can fulfill such stringent application-level requirements (i.e., can be expected to have enough consistent bandwidth) before it redirects the request. In general, if ALTO could convey such information via new endpoint properties, it would enable more sophisticated means for downstream CDN selection with ALTO.</t>
        </list></t>
        <!--
        <t>Why ALTO cannot be the request routing protocol itself ...
        </t>
        -->
      </section> <!-- ALTO background -->

     <!--
    <section anchor="designcons" title="Assumptions and High-Level Design Considerations">
      <t>In this section we list some assumptions and design issues to be considered when using ALTO for the CDNI Footprint and Capabilities Advertisement interface. See <xref target="RFC8008"/> for detailed discussions on FCI </t>

      <section anchor="general" title="General Assumptions and Considerations">

        <t>Below we list some general assumptions and considerations:

        <list style="symbols">
          <t>As explicitly being out-of-scope for CDNI <xref target="RFC6707" pageno="false" format="default"/>, it is assumed that ingestion of content or acquiring content across CDNs is not part of request routing as considered within CDNI standardization work. The focus of using ALTO (as considered in this document) is hence on request routing only, assuming that the content (desired by the end user) is available in the downstream CDN (uor can be acqired by the downstream CDN by some means).
          </t>

          <t>Federation Model: "Footprint and Capabilities Advertisement" and in general CDN request routing depends on the federation model among the CDN providers. Designing a suitable solution thus depends on whether a solution is needed for different settings, where CDNs consist of both NSP CDNs (serving individual ASes) and general, traditional CDNs (such as Akamai). We assume that CDNI is not designed for a setting where only NSP CDNs each serve a single AS only.</t>

          <t>In this document, it is assumed that the upstream CDN (uCDN) makes the decision on selecting a downstream CDN, based on information that each downstream CDN has made available to the upstream CDN. Further, we assume that in principle more than one dCDN may be suitable for a given end-user request (i.e. different dCDNs may claim "overlapping" footprints). The uCDN hence potentially has to select among several candidate downstream CDNs for a given end user request.
          </t>

          <t>It is not clear what kind(s) of business, contract, and operational relationships two peering CDNs may form. For the Internet, we see provider-customer and peering as two main relations; providers may use different charging models (e.g., 95-percentile, total volume) and may provide different SLAs. Given such unknown characteristics of CDN peering business agreements, we should design the protocol to support as much diverse potential business and operational models as possible.</t>
        </list>
        </t>
      </section>
    -->



    </section> <!-- Background -->

      <!--
      <section anchor="altoselectionadvantages" title="Advantages of using ALTO as the CDNI FCI protocol"> -->


         <!--
         <section anchor="altoCDNselection" title="Selection of a Downstream CDN with ALTO">



         <t>
         Under the considerations stated in <xref target="designcons"/>, ALTO can help the upstream CDN provider to select a proper downstream CDN provider for a given end user request as follows: Each downstream CDN provider hosts an ALTO server which provides ALTO services which convey CDNI FCI information to an ALTO client at the upstream CDN provider.
         </t>



         </section>


      </section>
         -->

    <section anchor="cdnifcimap" title="CDNI FCI Map">
    	<t>
          The ALTO protocol is based on an ALTO Information Service Framework which consists of several services, where all ALTO services are "provided through a common transport protocol, messaging structure and encoding, and transaction model" <xref target="RFC7285" pageno="false" format="default"/>. The ALTO protocol specification <xref target="RFC7285" pageno="false" format="default"/> defines several such services, e.g. the ALTO map service.
      </t>

      <t>
          This document defines a new ALTO Map Service called "CDNI FCI Map Service" which conveys JSON objects of media type "application/alto-cdnifcimap+json". These JSON objects are used to transport BaseAdvertisementObject objects defined in <xref target="RFC8008"/>; this document specifies how to transport such BaseAdvertisementObject objects via the ALTO protocol with the ALTO "CDNI FCI Map Service". Given that the "CDNI FCI Map Service" is very similar in structure to the two already defined map services (network maps and cost maps), the specification of CDNI FCI Map below uses the same specification structure for Cost Map specification in Section 11.2.3 of <xref target="RFC7285" pageno="false" format="default"/> when specifying cost maps.
        </t>
    	<section title="Media Type" anchor="cdnifcimapmediatype">
    		<t>
    		    The media type of the CDNI FCI Map is "application/alto-cdnifcimap+json".
    		</t>
    	</section>
    	<section title="HTTP Method">
    		<t>
    		    A CDNI FCI map resource is requested using the HTTP GET method.
    		</t>
    	</section>
    	<section title="Accept Input Parameters">
    		<t>
    		    None.
    		</t>
    	</section>
    	<section title="Capabilities">
    		<t>
    			None.
    		</t>
    	</section>
    	<section title="Uses">
    		<t>
    		    The resource ID of the resource based on which the CDNI FCI map will be defined. For example, if a CDNI FCI map depends on a network map, the resource ID of the network map MUST be included in "Uses" field. Please see <xref target="cdnifcinetworkmap"/> for details. If the CDNI FCI map does not depend on any other resources, "Uses" field MUST NOT appear.
    		</t>
    	</section>
    	<section title="Response" anchor="cdnifcimapencoding">
    		<t>
    			The "meta" field of a CDNI FCI map response MUST include the "vtag" field defined in Section 10.3 of <xref target="RFC7285" pageno="false" format="default"/>, which provides the version tag of the retrieved CDNI FCI map. If a CDNI FCI map response depends on a resource such as a network map, it MUST include the "dependent-vtags" field, whose value is an array to indicate the version tag of the resource used, where the resource is specified in "uses" of the IRD. The current defined dependent resource is only network map, and the usage of it is described in <xref target="cdnifcinetworkmap"/>.

    			The data component of an ALTO CDNI FCI map response is named "cdni-fci-map", which is a JSON object of type CDNIFCIMapData:
    		</t>
        <figure align="left">
              <artwork align="left"><![CDATA[
    object {
        CDNIFCIMapData cdni-fci-map;
    } InfoResourceCDNIFCIMap : ResponseEntityBase;

    object {
        BaseAdvertisementObject capabilities<1..*>;
    } CDNIFCIMapData
                ]]></artwork>
        </figure>
            <t>
                Specifically, a CDNIFCIMapData object is a JSON object, and it includes only one property "capabilities" and whose value is an array of BaseAdvertisementObject objects. The syntax and semantics of BaseAdvertisementObject are well defined in Section 5.1 of <xref target="RFC8008" pageno="false" format="default"/>. BaseAdvertisementObject object consists of capability-type, capability-value and footprints. And footprints are defined in Section 4.2.2.2 of <xref target="RFC8006" pageno="false" format="default"/>. 
            </t>
            <t>
<!--                 The ALTO server MUST interpret footprints appearing multiple times as if they appeared only once. Footprint restriction information MAY be specified using multiple different footprint-types.  -->
                For each BaseAdvertisementObject, the ALTO client MUST interpret footprints appearing multiple times as if they appeared only once. If no footprint restriction list is specified (or an empty list is specified), the ALTO client MUST understand that all footprint types are reset to the "global" coverage.
            </t>
            <t>
                Note: Further optimization of BaseAdvertisement objects to effectively provide the advertisement of capabilities with footprint restrictions is certainly possible, however, it is not necessary for the basic interconnection of CDNs. The note here is for completeness, however, the specifics of such mechanisms are outside the scope of this document.            	
            </t>
<!--             <t>
            	Capability objects of a given capability type with identical footprint restrictions MUST be combined into a single capability object. And footprints with the same capability type and capability value MUST be combined into a single capability object.
            </t> -->
<!--             <t>
                Multiple BaseAdvertisementObject objects with the same capability type are allowed within a given CDNI FCI Map response as long as the capability option footprint-value do not overlap, i.e., a given capability option value MUST NOT show up in multiple BaseAdvertisementObject objects with the same capability type. If multiple BaseAdvertisementObject objects for a given capability type exist, those capability objects MUST have different footprint restrictions. Capability objects of a given capability type with identical footprint restrictions MUST be combined into a single capability object. 
            </t> -->
<!--             <t>
                Multiple FCIMapData objects with the same capability type are allowed within a given CDNI FCI Map response as long as the capability option footprint-value do not overlap, i.e., a given capability option value MUST NOT show up in multiple FCIMapData objects within a single CDNI FCI Map response.  If multiple FCIMapData objects for a given capability type exist, those capability objects MUST have different footprint restrictions.  Capability objects of a given capability type with identical footprint restrictions MUST be combined into a single capability object.           	
            </t> -->
    	</section>
    	<section title="Examples">
    		<section title="IRD Example" anchor="IRDexample">
    			<t>
    				Below is an example IRD announcing two network maps, one CDNI FCI map without dependency, one CDNI FCI map depending on a network map, one filtered CDNI FCI map defined in <xref target="filteredcdnifcimap"/>, one unified property map including "cdni-fci-capabilities" as its entities' property, one filtered unified property map including "cdni-fci-capabilities" and "pid" as its entities' properties and two update stream services (one for updating CDNI FCI maps, and the other for updating property maps).
    			</t>
		    <figure align="left">
              <artwork align="left"><![CDATA[
  GET /directory HTTP/1.1
  Host: alto.example.com
  Accept: application/alto-directory+json,application/alto-error+json
]]></artwork>
            </figure>            
		    <figure align="left">
              <artwork align="left"><![CDATA[
{
  "meta" : { ... },
  "resources": {
    "my-default-network-map": {
      "uri" : "http://alto.example.com/networkmap",
      "media-type" : "application/alto-networkmap+json"
    },
    "my-eu-netmap" : {
      "uri" : "http://alto.example.com/myeunetmap",
      "media-type" : "application/alto-networkmap+json"
    },
    "my-default-cdnifci-map": {
      "uri" : "http://alto.example.com/cdnifcimap",
      "media-type": "application/alto-cdnifcimap+json"
    },
    "my-filtered-cdnifci-map" : {
      "uri" : "http://alto.example.com/cdnifcimap/filtered",
      "media-type" : "application/alto-cdnifcimap+json",
      "accepts" : "application/alto-cdnifcimapfilter+json",
      "uses" : [ "my-default-cdnifci-map" ]
    },
    "my-cdnifci-map-with-network-map-footprints": {
      "uri" : "http://alto.example.com/networkcdnifcimap",
      "media-type" : "application/alto-cdnifcimap+json",
      "uses" : [ "my-eu-netmap" ]
    },
    "cdnifci-property-map" : {
      "uri" : "http://alto.example.com/propmap/full/cdnifci",
      "media-type" : "application/alto-propmap+json",
      "capabilities" : {
        "domain-types" : [ "ipv4", "ipv6", "coutrycode", "asn" ],
        "prop-types" : [ "cdni-fci-capabilities" ]
      }
    },
    "filtered-cdnifci-property-map" : {
      "uri" : "http://alto.example.com/propmap/lookup/cdnifci-pid",
      "media-type" : "application/alto-propmap+json",
      "accpets" : "application/alto-propmapparams+json",
      "capabilities" : {            
        "domain-types" : [ "ipv4", "ipv6", "coutrycode", "asn" ],
        "prop-types" : [ "cdni-fci-capabilities", "pid" ]
       }
    },
    "update-my-cdni-fci-maps" : {
      "uri": "http:///alto.example.com/updates/cdnifcimaps",
      "media-type" : "text/event-stream",
      "accepts" : "application/alto-updatestreamparams+json",
      "uses" : [
        "my-default-network-map",
        "my-eu-netmap",
        "my-default-cdnifci-map",
        "my-filtered-cdnifci-map"
        "my-cdnifci-map-with-network-map-footprints"
      ],
      "capabilities" : {
        "incremental-change-media-types" : {
          "my-default-network-map" : "application/json-patch+json",
          "my-eu-netmap" : "application/json-patch+json",
          "my-default-cdnifci-map" : 
          "application/merge-patch+json,application/json-patch+json",
          "my-filtered-cdnifci-map" :
          "application/merge-patch+jso,application/json-patch+json",
          "my-cdnifci-map-with-network-map-footprints" : 
          "application/merge-patch+json,application/json-patch+json"
        }
      }
    },
    "update-my-props": {
      "uri" : "http://alto.example.com/updates/properties",
      "media-type" : "text/event-stream",
      "uses" : [
        "cdnifci-property-map",
        "filtered-cdnifci-property-map"
      ],
      "capabilities" : {
        "incremental-change-media-types": {
          "cdnifci-property-map" : 
          "application/merge-patch+json,application/json-patch+json",
          "filtered-cdnifci-property-map": 
          "application/merge-patch+json,application/json-patch+json"            
        }
      }
    }
  }
}
]]></artwork>
            </figure>  
    		</section>
    		<section title="Basic Example" anchor="fullcdnifcimap">
          <t>
            In this example, we demonstrate a simple CDNI FCI map; this map does not depend on other resources.
          </t>
		    <figure align="left">
              <artwork align="left"><![CDATA[
GET /cdnifcimap HTTP/1.1
Host: alto.example.com
Accept: application/alto-cdnifcimap+json,application/alto-error+json
]]></artwork>
            </figure>
                              
		    <figure align="left">
              <artwork align="left"><![CDATA[
    HTTP/1.1 200 OK
    Content-Length: XXX
    Content-Type: application/alto-cdnifcimap+json
    {
      "meta" : {
        "vtag": {
          "resource-id": "my-default-cdnifci-map",
          "tag": "da65eca2eb7a10ce8b059740b0b2e3f8eb1d4785"
        }
      },
      "cdni-fci-map": {
        "capabilities": [
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          },
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "https/1.1",
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          },
          {
            "capability-type": "FCI.AcquisitionProtocol",
            "capability-value": {
              "acquisition-protocols": [
                "https/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          }
        ]
      }
    }
]]></artwork>
            </figure>    			
    		</section>
    		<section title="Incremental Updates Example">
    			<t>
    				A benefit of using ALTO to provide CDNI FCI maps is that such maps can be updated using ALTO incremental updates. Below is an example that also shows a benefit of using a JSON merge patch to encode a big update and using a JSON patch to encode a small update.
    			</t>
        <figure align="left">
              <artwork align="left"><![CDATA[
  POST /updates/cdnifcimaps HTTP/1.1
  Host: alto.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: ###

  { "add": {
      "my-cdnifci-stream": {
          "resource-id": "my-default-cdnifci-map"
      }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "http://alto.example.com/updates/streams/3141592653589"}

  event: application/alto-cdnifcimap+json,my-fci-stream
  data: { ... full CDNI FCI map ... } 

  event: application/merge-patch+json,my-fci-stream
  data: {
  data:   "meta": {
  data:     "vtag": {
  data:       "tag": "dasdfa10ce8b059740bddsfasd8eb1d47853716"
  data:     }
  data:   },
  data:   {
  data:     "capability-type": "FCI.DeliveryProtocol",
  data:     "capability-value": {
  data:       "delivery-protocols": [
  data:         "http/1.1"
  data:       ]
  data:     },
  data:     "footprints": [
  data:       <Footprint objects that are different from 
  data:        footprint objects in delivery-protocols http/1.1>
  data:     ]
  data:   }     
  data: }

  event: application/json-patch+json,my-fci-stream
  data: [
  data:   {
  data:     "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
  data:   },
  data:   { "op": "add",
  data:     "path": "/cdni-fci-map/capabilities/0/footprints/-",
  data:     "value": "ipv4:192.0.2.0/24"
  data:   }
  data: ]
                ]]></artwork>
            </figure>    			
    		</section>
    	</section>
    </section>

    <section title="CDNI FCI Map using ALTO Network Map" anchor="cdnifcinetworkmap">
        <section title="Introduce Footprint Type: altonetworkmap">
        <t>
        	In addition to the already defined CDNI footprint typs (e.g., ipv4cidr, ipv6cidr, asn, countrycode), ALTO network maps can be a type of FCI footprint. To enable such referencing to ALTO network maps, a new CDNI Footprint Type "altonetworkmap" is defined (see also <xref target="newfootprinttype"/>).
        </t>
        <t>
        	All altonetworkmap entries MUST be of type PIDName (as defined in <xref target="RFC7285" pageno="false" format="default"/>, where PIDName corresponds to a PID in the ALTO network map referenced by the resource ID of the network map listed in "dependent-vtags" field).
        </t>
        </section>
        <section title="Examples">
    		<section title="IRD Example">
    		<t>
    			We use the same IRD example given by <xref target="IRDexample"/>.
    		</t> 
    		</section>
          <section title="ALTO Network Map for CDNI FCI Footprints Example" anchor="networkmapexample">
            <t>
              Below is an example network map that is referenced by the CDNI FCI map example in <xref target="networkmapfootprint"/> 
            </t>
                      <figure align="left">
           <artwork align="left"><![CDATA[
 GET /networkmap HTTP/1.1
 Host: http://alto.example.com/myeunetmap
 Accept: application/alto-networkmap+json,application/alto-error+json
]]></artwork>
            </figure>               
                      <figure align="left">
              <artwork align="left"><![CDATA[
    HTTP/1.1 200 OK
    Content-Length: XXX
    Content-Type: application/alto-networkmap+json

    {
      "meta" : {
        "vtag": [
          {"resource-id": "my-eu-netmap",
           "tag": "3ee2cb7e8d63d9fab71b9b34cbf764436315542e"
          }
        ]
      },
      "network-map" : {
        "south-france" : {
          "ipv4" : [ "192.0.2.0/24", "198.51.100.0/25" ]
        },
        "germany" : {
          "ipv4" : [ "192.0.3.0/24"]
        }
      }
    }
]]></artwork>
            </figure>
          </section>
          <section title="ALTO Network Map Footprints in CDNI FCI Map" anchor="networkmapfootprint">
            <t>
              In this example, we show a CDNI FCI map that depends on a network map described in <xref target="networkmapexample"/>.
            </t>
                    <figure align="left">
              <artwork align="left"><![CDATA[
 GET /networkcdnifcimap HTTP/1.1
 Host: alto.example.com
 Accept: application/alto-cdnifcimap+json,application/alto-error+json
]]></artwork>
            </figure> 
        <figure align="left">
              <artwork align="left"><![CDATA[
    HTTP/1.1 200 OK
    Content-Length: 618
    Content-Type: application/alto-cdnifcimap+json

    {
      "meta" : {
        "dependent-vtags" : [
          {
            "resource-id": "my-eu-netmap",
            "tag": "3ee2cb7e8d63d9fab71b9b34cbf764436315542e"
          }
        ]
      },
      "cdni-fci-map": {
        "capabilities": [
          { "capability-type": "FCI.DeliveryProtocol",
            "capability-value": [
              "http/1.1"
            ]
          },
          { "capability-type": "FCI.DeliveryProtocol",
            "capability-value": [
            "values": [
              "https/1.1"
            ],
            "footprints": [
              { "footprint-type": "altonetworkmap",
                "footprint-value": [
                  "germany",
                  "south-france"
                ]
              }
            ]
          }
        ]
      }
    }
]]></artwork>
            </figure> 
          </section>
          <section title="Incremental Updates Example">
            <t>
              In this example, the ALTO client is interested in changes of "my-cdnifci-map-with-network-map-footprints". And we present two patches here. The first one of it is to change footprints of http/1.1 Delivery Protocol capability, and the second one is to remove "south-france" from the footprints of https/1.1 Delivery Protocol capability.
            </t>
        <figure align="left">
              <artwork align="left"><![CDATA[
  POST /updates/cdnifcimaps HTTP/1.1
  Host: alto.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: ###

  { "add": {
      "my-network-map-cdnifci-stream": {
          "resource-id": "my-cdnifci-map-with-network-map-footprints"
      }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "http://alto.example.com/updates/streams/3141592653590"}

  event: application/alto-cdnifcimap+json,my-fci-stream
  data: { ... full CDNI FCI map ... } 

  event: application/merge-patch+json,my-fci-stream
  data: {
  data:   "meta": {
  data:     "dependent-vtags" : [
  data:      {
  data:        "resource-id": "my-eu-netmap",
  data:        "tag": "3ee2cb7e8d63d9fab71b9b34cbf764436315542e"
  data:      }
  data:     ],  
  data:     "vtag": {
  data:       "tag": "dasdfa10ce8b059740bddsfasd8eb1d47853716"
  data:     }
  data:   },
  data:   {
  data:     "capability-type": "FCI.DeliveryProtocol",
  data:     "capability-value": {
  data:       "delivery-protocols": [
  data:         "http/1.1"
  data:       ]
  data:     },
  data:     "footprints": [
  data:       <Footprint objects that are different from 
  data:        footprint objects in delivery-protocols http/1.1>
  data:     ]
  data:   }     
  data: }

  event: application/json-patch+json,my-fci-stream
  data: [
  data:   {
  data:     "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
  data:   },
  data:   { "op": "remove",
  data:     "path": "/cdni-fci-map/capabilities/2/footprints/0/
  data:       footprint-value/1",
  data:   }
  data: ]
                ]]></artwork>
            </figure>  
          </section>
        </section>
    </section>

    <section anchor="filteredcdnifcimap" title="Filtered CDNI FCI Map using Capabilities">
    	<t>
    		This document defines a new service named "Filtered CDNI FCI Map Service". The semantic of a Filtered CDNI FCI Map is that given some capabilities, which footprints have at least one of these capabilities. And a filtered CDNI FCI map is a CDNI FCI map for which an ALTO client may supply additional capabilities to limit the scope of the resulting CDNI FCI map. The relationship between a filtered CDNI FCI map and a CDNI FCI Map is similar to the relationship between a filtered network/cost map and a network/cost map.
    	</t>
    	<section title="Media Type">
        <t>
          Since a filtered CDNI FCI map is still a CDNI FCI map, it uses the media type defined for CDNI FCI maps in <xref target="cdnifcimapmediatype"/>.
        </t>
    	</section>
    	<section title="HTTP Method">
        <t>
          A filtered CDNI FCI map is requested using the HTTP POST method.
        </t>
    	</section>
    	<section title="Accept Input Parameters">
    	<t>The input parameters for a filtered CDNI FCI map are supplied in the entity body of the POST request. This document specifies the input parameters with a data format indicated by the media type "application/alto-cdni-filter", which is a JSON object of type ReqFilteredCDNIFCIMap, where:</t>
  		<figure align="left">
            <artwork align="left"><![CDATA[
   object {
       JSONString capability-type;
       JSONValue capability-value;
   } CDNIFCICapability;

   object {
       [CDNIFCICapability cdni-fci-capabilities<0..*>;]
   } ReqFilteredCDNIFCIMap;
]]>         </artwork>
        </figure>
        <t>with fields: </t>
        <t><list style="hanging">
            <t hangText="capability-type:">
            	The same as Base Advertisement Object's capability-type defined in Section 5.1 of <xref target="RFC8008" pageno="false" format="default"/>.
            </t>
            <t hangText="capability-value:">
                The same as Base Advertisement Object's capability-value defined in Section 5.1 of <xref target="RFC8008" pageno="false" format="default"/>.
            </t>
            <t hangText="cdni-fci-capabilities:">
            	A list of CDNI FCI capabilities defined in Section 5.1 of <xref target="RFC8008" pageno="false" format="default"/> for which footprints are to be returned. If a list is empty, the ALTO server MUST interpret it as a request for the full CDNI FCI Map. The ALTO server MUST interpret entries appearing in a list multiple times as if they appeared only once. The ALTO client SHOULD avoid the same entries appearing in "cdni-fci-capabilities" multiple times. If the "cdni-fci-capabilities" field is not present, the ALTO server MUST interpret it as a request for the full CDNI FCI Map. If a "capability-type" or a "capability-value" is not defined, the ALTO server MUST ignore this capability. If it is the only capability in the list, the ALTO server MUST return nothing.
            </t>
        </list></t>
    	</section>
    	<section title="Capabilities">
    		<t>
    		    None.
    	    </t>
    	</section>
    	<section title="Uses">
        <t>
          The resource ID of the CDNI FCI map based on which the filtering is performed.
        </t>
    	</section>
    	<section title="Response">
    	<t>
    		The format is the same as an unfiltered CDNI FCI map. See <xref target="cdnifcimapencoding"/> for the format.
    	</t>
    	<t>
    		The returned CDNI FCI map MUST contain only BaseAdvertisementObject objects whose CDNI capability object is the superset of one of CDNI capability object in "cdni-fci-capabilities". Specifically, that a CDNI capability object A is the superset of another CDNI capability object B means that these two CDNI capability objects have the same capability type and mandatory properties in capability value of A MUST include mandatory properties in capability value of B semantically. For example, if a CDNI FCI capability in "cdni-fci-capabilities" is Delivery Protocol capability object with "http/1.1" in its field "delivery-protocols" and the original full CDNI FCI map has two CDNI FCI objects whose capabilities are Delivery Protocol capability objects with ["http/1.1"] and ["http/1.1", "https/1.1"] in their field "delivery-protocols" respectively, both of these two CDNI FCI objects MUST be returned. If the input parameters contain a CDNI capability object that is not currently defined, the ALTO server MUST behave as if the CDNI capability object did not appear in the input parameters. 
    	</t>
    	<t>
    		The version tag included in the "vtag" field of the response MUST correspond to the full CDNI FCI map resource from which the filtered CDNI FCI map is provided. This ensures that a single, canonical version tag is used independently of any filtering that is requested by an ALTO client.
    	</t>
    	</section>
    	<section title="Examples">
    		<section title="IRD Example">
    		<t>
    			We use the same IRD example by <xref target="IRDexample"/>.
    		</t> 
    		</section>
    		<section title="Basic Example">
    			<t>
    			    This example is filtering the full CDNI FCI map example in <xref target="fullcdnifcimap"/>.
    			</t>
		    <figure align="left">
              <artwork align="left"><![CDATA[
   POST /cdnifcimap/filtered HTTP/1.1
   HOST: alto.example.com
   Content-Type: application/cdnifilter+json
   Accept: application/alto-cdnifcimap+json

   {
     "cdni-fci-capabilities": [
       {
         "capability-type": "FCI.DeliveryProtocol",
         "capability-value": {
           "delivery-protocols": [
              "http/1.1"
           ]
         }
       }
     ]
   }
]]></artwork>
            </figure>

		    <figure align="left">
              <artwork align="left"><![CDATA[
    HTTP/1.1 200 OK
    Content-Length: XXX
    Content-Type: application/alto-cdnifcimap+json
    {
      "meta" : {
        "vtag": {
          "resource-id": "my-default-cdnifci-map",
          "tag": "da65eca2eb7a10ce8b059740b0b2e3f8eb1d4785"
        }
      },
      "cdni-fci-map": {
        "capabilities": [
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          },
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "https/1.1",
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          }
        ]
      }
    }
]]></artwork>
            </figure>
    		</section>
    		<section title="Incremental Updates Example">
          <t>
            In this example, the ALTO client only cares about the updates of one Delivery Protocol object whose value is "http/1.1". So it adds its limitation of capabilities in "input" field of the POST request.
          </t>
        <figure align="left">
              <artwork align="left"><![CDATA[
  POST /updates/cdnifcimaps HTTP/1.1
  Host: fcialtoupdate.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: ###

  { "add": {
      "my-fci-stream": {
          "resource-id": "my-filtered-cdnifci-map",
          "input": {
            "cdni-fci-capabilities": [
            {
              "capability-type": "FCI.DeliveryProtocol",
              "capability-value": {
                "delivery-protocols": [
                  "http/1.1"
                ]
              }
            }
          ]                
        }
      }
    }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "http://alto.example.com/updates/streams/3141592653590"}

  event: application/alto-cdnifcimap+json,my-fci-stream
  data: { ... full filtered CDNI FCI map ... } 

  event: application/merge-patch+json,my-fci-stream
  data: {
  data:   "meta": {
  data:     "vtag": {
  data:       "tag": "dasdfa10ce8b059740bddsfasd8eb1d47853716"
  data:     }
  data:   },
  data:   {
  data:     "capability-type": "FCI.DeliveryProtocol",
  data:     "capability-value": {
  data:       "delivery-protocols": [
  data:         "http/1.1"
  data:       ]
  data:     },
  data:     "footprints": [
  data:       <Footprint objects that are different from 
  data:        footprint objects in delivery-protocols http/1.1>
  data:     ]
  data:   }     
  data: }

  event: application/json-patch+json,my-fci-stream
  data: [
  data:   {
  data:     "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
  data:   },
  data:   { "op": "add",
  data:     "path": "/cdni-fci-map/capabilities/0/footprints/-",
  data:     "value": "ipv4:192.0.2.0/24"
  data:   }
  data: ]
                ]]></artwork>
            </figure>         
    		</section>
    	</section>
    </section>

    <section anchor="upm" title="Query Footprint Properties using ALTO Unified Property Service">
        <t>
        	In this section, we describe how ALTO clients look up properties for individual footprints. Our design decision here is to use ALTO unified property map service to query footprint properties because we do not want to introduce extra complexity and ALTO unified property map defined in <xref target="I-D.ietf-alto-unified-props-new"/> already meets the requirement. A footprint is a group of entities, and CDNI capabilities can be regarded as properties of a footprint. Unified property map is used to provide properties for collections of entities such as CIDRs or PIDs. So every footprint can be presented as a set of entities, and we will describe it in details in <xref target="footprinttoentities"/>. In addition, two resource types Property Maps and Filtered Property Maps are already well-defined in <xref target="I-D.ietf-alto-unified-props-new"/>.
        </t>
        <t>
            A unified property map that includes "cdni-fci-capabilities" property registered in <xref target="iana"/> builds the inverted index of a CDNI FCI map. The building process consists of two steps: firstly, each footprint object is represented as a set of unified property map entities in a domain; secondly, each unified property map entity is mapped into a list of property objects including CDNI capabilities.      
        </t>
  	    <section title="Representing Footprint Objects as Unified Property Map Entities" anchor="footprinttoentities">
            <t>
                A footprint object has two properties: footprint-type and footprint-value. A footprint-value is an array of footprint values conforming to the specification associated with the registered footprint type ("ipv4cidr", "ipv6cidr", "asn", and "countrycode"). Since each unified property map entity has a unique address and each pair of footprint-type and a footprint value determines a group of unique addresses, a footprint object can be represented as a set of entities according to their different footprint-type and footprint values. However, <xref target="I-D.ietf-alto-unified-props-new"/> only defines IPv4 Domain and IPv6 Domain which represent footprint-type "ipv4cidr" and "ipv6cidr" respectively. To represent footprint-type "asn" and "countrycode", this document registers two new domains in <xref target="iana"/>.
            </t>
            <t>
                Here gives an example of representing a footprint object as a set of unified property map entities.
            </t>
            <t>
                {"footprint-type": "ipv4cidr", "footprint-value": ["192.0.2.0/24", "198.51.100.0/24"]} --> "ipv4:192.168.2.0/24", "ipv4:198.51.100.0/24"
            </t>
  		    <section title="ASN Domain">
  			    <t>
  			        This document specifies a new domain in addition to the ones in <xref target="I-D.ietf-alto-unified-props-new"/>. ASN is the abbreviation of Autonomous System Number.
  		        </t>
  		        <section title="Domain Name">
  		    	    <t>
  		    		    asn
  		    	    </t>
  		        </section>
  		        <section title="Domain-Specific Entity Addresses" anchor="asn-entity-address">
  		    	    <t>
  		                 The entity address of asn domain is encoded as a string consisting of the characters "as" (in lowercase) followed by the ASN <xref target="RFC6793" pageno="false" format="default"/>.
  		            </t>
  		        </section>
  		        <section title="Hierarchy and Inheritance">
  		        	<t>
  		        		There is no hierarchy or inheritance for properties associated with ASN.
  		        	</t>
  		        </section>
            </section>
            <section title="COUNTRYCODE Domain">
        	    <t>
        		    This document specifies a new domain in addition to the ones in <xref target="I-D.ietf-alto-unified-props-new"/>.
        	    </t>
        	    <section title="Domain Name">
        		    <t>
        			    countrycode
        		    </t>
        	    </section>
        	    <section title="Domain-Specific Entity Addresses" anchor="countrycode-entity-address">
        		    <t>
        			    The entity address of countrycode domain is encoded as an ISO 3166-1 alpha-2 code <xref target="ISO3166-1"/> in lowercase.
        		    </t>
        	    </section>
        	    <section title="Hierarchy and Inheritance">
        	    	<t>
                  There is no hierarchy or inheritance for properties associated with country codes.
                </t>
  		        </section>
            </section>
  	    </section>
        <section title="Examples">
    		<section title="IRD Example">
    		<t>
    			We use the same IRD example given by <xref target="IRDexample"/>.
    		</t> 
    		</section>
        	<section title="Property Map Example">
            <t>
              This example shows a full unified property map in which entities are footprints and entities' property is "cdni-fci-capabilities".
            </t>
   	        		    <figure align="left">
              <artwork align="left"><![CDATA[
    GET /propmap/full/cdnifci HTTP/1.1
    HOST: alto.example.com
    Accept: application/alto-propmap+json,application/alto-error+json
]]></artwork>
            </figure> 
		    <figure align="left">
              <artwork align="left"><![CDATA[
    HTTP/1.1 200 OK
    Content-Length: ###
    Content-Type: application/alto-propmap+json

    {
      "property-map": {
        "meta": {
          "dependent-vtags": [
            {"resource-id": "my-default-cdnifci-map",
             "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf62"}
          ]
        },
        "countrycode:us": {
          "cdni-fci-capabilities": [{"capability-type":,
                                         "capability-value":}]
        },
        "ipv4:192.0.2.0/24": {
          "cdni-fci-capabilities": [{"capability-type":,
                                         "capability-value":}]
        },
        "ipv4:198.51.100.0/24": {
          "cdni-fci-capabilities": [{"capability-type":,
                                         "capability-value":}]
        },
        "ipv6:2001:db8::/32": {
          "cdni-fci-capabilities": [{"capability-type":,
                                         "capability-value":}]
        },
        "asn:as64496": {
          "cdni-fci-capabilities": [{"capability-type":,
                                         "capability-value":}]
        }
      }
    }
]]></artwork>
            </figure>
        	</section>
        	<section title="Filtered Property Map Example">
            <t>
              In this example, we use filtered property map service to get "pid" and "cdni-fci-capabilities" properties for two footprints "ipv4:192.0.2.0/24" and "ipv6:2001:db8::/32".
            </t>
                  <figure align="left">
              <artwork align="left"><![CDATA[
   POST /propmap/lookup/cdnifci-pid HTTP/1.1
   HOST: alto.example.com
   Content-Type: application/alto-propmapparams+json
   Accept: application/alto-propmap+json,application/alto-error+json
   Content-Length:

   {
     "entities": [
       "ipv4:192.0.2.0/24",
       "ipv6:2001:db8::/32"
     ],
     "properties": [ "cdni-fci-capabilities", "pid" ]
   }
]]></artwork>
            </figure>

        <figure align="left">
              <artwork align="left"><![CDATA[
   HTTP/1.1 200 OK
   Content-Length: ###
   Content-Type: application/alto-propmap+json

   {
     "property-map": {
       "meta": {
         "dependent-vtags": [
            {"resource-id": "my-default-cdnifci-map",
              "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf62"},
            {"resource-id": "my-default-networkmap",
              "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf63"}
         ]
       },
       "ipv4:192.0.2.0/24": {
         "cdni-fci-capabilities": [{"capability-type":,
                                        "capability-value":}],
         "pid": "pid1"
       },
       "ipv6:2001:db8::/32": {
         "cdni-fci-capabilities": [{"capability-type":,
                                        "capability-value":}],
          "pid": "pid3"
       }
     }
   }
]]></artwork>
            </figure>
        	</section>
        	<section title="Incremental Updates Example">
            <t>
              In this example, here is a client want to request updates for the properties "cdni-fci-capabilities" and "pid" for two footprints "ipv4:192.0.2.0/24" and "ipv6:2001:db8::/32".
            </t>
        <figure align="left">
              <artwork align="left"><![CDATA[
   POST /updates/properties HTTP/1.1
   Host: alto.example.com
   Accept: text/event-stream,application/alto-error+json
   Content-Type: application/alto-updatestreamparams+json
   Content-Length: ###

   { "add": {
     "property-map-including-capability-property": {
       "resource-id": "filtered-cdnifci-property-map",
         "input": {
           "properties": ["cdni-fci-capabilities", "pid"],
           "entities": [
             "ipv4:192.0.2.0/24",
             "ipv6:2001:db8::/32"
           ]
         }
       }
   }

   HTTP/1.1 200 OK
   Connection: keep-alive
   Content-Type: text/event-stream

   event: application/alto-updatestreamcontrol+json
   data: {"control-uri":
   data: "http://alto.example.com/updates/streams/1414213562373"}

   event: application/alto-cdnifcimap+json,my-fci-stream
   data: { ... full filtered unified property map ... } 

   event: application/merge-patch+json,my-fci-stream
   data: {
   data:   "property-map": 
   data:   {
   data:     "meta": {
   data:       "dependent-vtags": [
   data:         {"resource-id": "my-default-cdnifci-map",
   data:          "tag": "2beeac8ee23c3dd1e98a73fd30df80ece9fa5627"},
   data:         {"resource-id": "my-default-networkmap",
   data:          "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf63"}
   data:       ]
   data:     },
   data:     "ipv4:192.0.2.0/24": 
   data:     {
   data:       "cdni-fci-capabilities": 
   data:         [{"capability-type":,"capability-value":}]
   data:     }
   data:   }
   data: }

   event: application/json-patch+json,my-fci-stream
   data: {[
   data: {
   data:   { "op": "replace",
   data:       "path": "/meta/dependent-vtags/0/tag",
   data:       "value": "61b23185a50dc7b334577507e8f00ff8c3b409e4"
   data:   },
   data:   { "op": "replace",
   data:       "path": "/property-map/ipv4:192.0.2.0/124/",
   data:       "value": "pid5"
   data:   }
   data: }
   data: ]}
                ]]></artwork>
            </figure>   
        	</section>
        </section>
    </section>

  <section title="Protocol Errors">
    <t>
        Protocol errors are handled as specified in Section 8.5 of the ALTO protocol <xref target="RFC7285" pageno="false" format="default"/>.
    </t>
    <t>
<!--         Since the protocol errors are used to describe an error encoutering while processing a request, we explain how error codes defined in <xref target="RFC8008" pageno="false" format="default"/>  -->
        Here we explain the error-handling mechanism of filtered CDNI FCI map:
    </t>
 <!--    <t> -->
<!--         E_SYNTAX covers all cases of syntax errors of filtered CDNI FCI map queries. When the syntax of queries is correct, there may be some errors in queries' semantics. Such errors can be covered by E_MISSING_FIELD and E_INVALID_FIELD_VALUE. If a capability in the "cdni-fci-capabilities" only has "capability-type" or only has "capability-value" or the value of "capability-value" is null, these cases belong to E_MISSING_FIELD errors. If the value of "capability-value" is inconsistent with "capability-type", this case belongs to E_INVALID_FIELD_VALUE error.
    </t> -->
    <t>
    <list style="symbols">
    	<t>E_SYNTAX covers all cases of syntax errors of filtered CDNI FCI map queries.</t>
    	<t>When the syntax of queries is correct, there may be some errors in queries' semantics. Such Cases can be covered by E_INVALID_FIELD_VALUE:
    	<list style="symbols">
    		<t>The value of "capability-type" is null;</t>
    		<t>The value of "capability-value" is null;</t>
    		<!-- <t>If a capability in the "cdni-fci-capabilities" only has "capability-type" or only has "capability-value" or the value of "capability-value" is null, these cases belong to E_MISSING_FIELD errors.</t> -->
    		<t>The value of "capability-value" is inconsistent with "capability-type".</t>
    	</list>
    	</t>
    </list>
    </t>
    <t>
        The error-handling mechanism of query footprints is the same as the error-handling mechanism of ALTO Unified Property Map Service described in <xref target="I-D.ietf-alto-unified-props-new"/>.
    </t>
<!--     <t>
        To be noted that if "capability-type" is not defined, the ALTO server MUST ignore this capability. If it is the only capability in the list, the ALTO server MUST return nothing.
        there are two special cases which are not errors. If "cdni-fci-capabilities" is null or the value of it has no element, the ALTO server will return the related full CDNI FCI map. And 
    </t> -->
  </section>
 
  <section title="IANA Considerations" anchor="iana">
      <section title="CDNI Metadata Footprint Type Registry" anchor="newfootprinttype">
    <texttable anchor="tbl:footprint-type" align="center" title="CDNI Metadata Footprint Type">

            <ttcol align="left" width="16%">
              Footprint Type
            </ttcol>
            <ttcol align="left" width="34%">
              Description
            </ttcol>
            <ttcol align="left" width="34%">
              Specification
            </ttcol>

            <c>
              altonetworkmap
            </c>
            <c>
              A list of PID-names
            </c>
            <c>
              RFCthis
            </c>
    </texttable>
      <t>
        [RFC Editor: Please replace RFCthis with the published RFC number for this document.]
      </t>        
      </section>

      <section title="ALTO Entity Domain Registry">
    <t>
      As proposed in Section 9.2 of <xref target="I-D.ietf-alto-unified-props-new"/>,
      "ALTO Entity Domain Registry" is requested. Besides, two
      new domains are to be registered, listed in
      <xref target="tbl:entity-domain"/>.
    </t>
    <texttable anchor="tbl:entity-domain" align="center" title="ALTO Entity Domain">

            <ttcol align="left" width="16%">
              Identifier
            </ttcol>
            <ttcol align="left" width="34%">
              Entity Address Encoding
            </ttcol>
            <ttcol align="left" width="34%">
              Hierarchy &amp; Inheritance
            </ttcol>

            <c>
              asn
            </c>
            <c>
              See <xref target="asn-entity-address"/>
            </c>
            <c>
              None
            </c>

            <c>
              countrycode
            </c>
            <c>
              See <xref target="countrycode-entity-address"/>
            </c>
            <c>
              None
            </c>

    </texttable>

      </section>

      <section title="ALTO CDNI FCI Property Type Registry">
    <t>
      The "ALTO CDNI FCI Property Type
      Registry" is required by the ALTO Entity Domain
      "asn", "countrycode", "pid", "ipv4" and "ipv6", listed in
      <xref target="tbl:prop-type-register"/>.
    </t>
    <texttable anchor="tbl:prop-type-register" align="center" title="ALTO CDNI FCI Property Type">





            <ttcol align="left" width="16%">
              Identifier
            </ttcol>
            <ttcol align="left" width="29%">
              Intended Semantics
            </ttcol>

            <c>
              cdni-fci-capabilities
            </c>
            <c>
              An array of CDNI FCI capability objects
            </c>



    </texttable>

      </section>
  </section>

  <section anchor="security" title="Security Considerations">
  	     <t>
  	     	Although CDNI FCI Map resource defined in this document is relatively different from other existed resources defined in the base protocol, the Security Considerations of the base protocol (Section 15 of RFC7285) still apply.
  	     </t>
         <t>
          For authenticity and Integrity of ALTO information, an attacker may disguise itself as an ALTO server in a dCDN, and it may provide false capabilities and footprints to an ALTO client in a uCDN by the CDNI FCI map. Such false information may lead a uCDN to select a wrong dCDN to serve user requests or even block uCDNs utilizing some dCDNs in good condition.
         </t>
         <t>
          For potential undesirable guidance from authenticated ALTO information, dCDNs can provide a uCDN with limited capabilities and smaller footprint coverage so that dCDNs can avoid transferring traffic for a uCDN which they should have to transfer.  
         </t>
         <t>
          For confidentiality of ALTO information, an attacker may infer the whole and exact capabilities and footprints of a dCDN by means of pretending it is one of different uCDNs of a dCDN respectively, getting different CDNI FCI maps from a dCDN and combining these maps together.
         </t>
         <t>
          For privacy for ALTO users, querying footprint properties using ALTO unified property may expose network location identifiers (IP addresses or fine-grained PIDs) to the ALTO server in a dCDN. In such case, a dCDN may potentially monitor and analyze user behaviors and communication patterns of uCDNs' customers.
         </t>
         <t>
          For availability of ALTO services, an attacker may get the potential huge full CDNI FCI maps from an ALTO server in a dCDN continuously to run out of bandwidth resources of that ALTO server or may query filtered CDNI FCI services with complex capabilities to run out of computation resources of an ALTO server.
         </t>
         <t>
          Protection Strategies described in RFC 7285 can solve problems mentioned above well. However, the isolation of full CDNI FCI maps should also be considered.
         </t>
         <t>
          <!-- The identification of ALTO clients and ALTO servers is extremely important in CDNI. Because capabilities and footprints are key information for dCDNs and they are key factors influencing the final selection decision of a uCDN. --> 
          If a dCDN signs agreements with multiple uCDNs, it must isolate full CDNI FCI maps for different dCDNs in that uCDNs will not redirect requests which should not have to served by this dCDN to this dCDN.
         </t>
         <t>
          To avoid this risk, a dCDN may consider generating URIs of different full CDNI FCI maps by hashing its company ID, a uCDN's company ID as well as their agreements. And it needs to avoid expoing all CDNI FCI maps resources in its IRDs.
         </t>
<!--          <t>One important security consideration is the proper authentication of advertisement information provided by a downstream CDN. The ALTO protocol provides a specification for a signature of ALTO information (see Section 15 of <xref target="RFC7285" pageno="false" format="default"/>. ALTO thus provides a proper mechanism for protecting the integrity of FCI information.</t>

         <t>More Security Considerations will be discussed in a future version of this document.</t> -->
      </section>






       <section anchor="ack" title="Acknowledgments">
      <t>The authors would like to thank Kevin Ma, Daryl Malas, Matt Caulfield for their timely reviews and invaluable comments.</t>

      <t>Jan Seedorf is partially supported by the GreenICN project
      (GreenICN: Architecture and Applications of Green Information Centric
      Networking), a research project supported jointly by the European
      Commission under its 7th Framework Program (contract no. 608518) and
      the National Institute of Information and Communications Technology
      (NICT) in Japan (contract no. 167).  The views and conclusions
      contained herein are those of the authors and should not be
      interpreted as necessarily representing the official policies or
      endorsements, either expressed or implied, of the GreenICN project,
      the European Commission, or NICT.</t>
    </section>

  </middle>

  <back>

    <references title="Normative References">
      <?rfc include="reference.RFC.5693.xml" ?>
      <?rfc include="reference.RFC.6707.xml" ?>
      <!-- <?rfc include="reference.RFC.6770.xml" ?> -->
      <?rfc include="reference.RFC.6793.xml" ?>
      <?rfc include="reference.RFC.7285.xml" ?>
      <?rfc include="reference.RFC.7336.xml" ?>
      <!-- <?rfc include="reference.RFC.7337.xml" ?> -->
      <?rfc include="reference.RFC.8006.xml" ?>
      <?rfc include="reference.RFC.8008.xml" ?>
    <reference anchor="ISO3166-1"><front>
	<title>Codes for the representation of names of countries and their subdivisions -- Part 1: Country codes</title>
	<author>
	<organization>The International Organization for Standardization</organization>
	</author>

	<date year="2013"/>
	</front>

	<seriesInfo name="ISO" value="3166-1:2013"/>
	</reference>
    </references>


    <references title="Informative References">

      <!--
      <reference anchor="I-D.peterson-CDNI-strawman">
        <front>
          <title>Content Distribution Network Interconnection (CDNI) Problem Statement</title>

            <author initials="L." surname="Peterson" fullname="L. Peterson">
              <organization abbrev="Verivue Inc."/>
            </author>
            <author initials="J." surname="Hartman" fullname="J. Hartman">
              <organization abbrev="Verivue Inc."/>
            </author>
            <date month="May" year="2011"/>
        </front>
        <seriesInfo name="Internet-Draft" value="draft-peterson-CDNI-strawman-01"/>
      </reference>
      -->

      <!-- <?rfc include="reference.I-D.marocco-alto-next"?> -->
      <!-- <?rfc include="reference.I-D.marocco-alto-ws"?> -->
      <?rfc include="reference.I-D.draft-ietf-alto-incr-update-sse-07.xml"?>
      <?rfc include="reference.I-D.draft-jenkins-alto-cdn-use-cases-03.xml"?>
<!--       <?rfc include="reference.I-D.draft-ma-cdni-capabilities-09.xml"?> -->
      <?rfc include="reference.I-D.draft-ietf-alto-unified-props-new-00.xml"?>
      <!-- <?rfc include="reference.I-D.liu-cdni-cost"?> -->
      <!-- <?rfc include="reference.I-D.ietf-cdni-metadata"?>  -->
      <!-- <?rfc include="reference.I-D.ietf-cdni-logging"?> -->

    </references>

   </back>
</rfc>
