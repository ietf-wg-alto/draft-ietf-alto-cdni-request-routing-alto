<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC5693 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5693.xml">
<!ENTITY RFC6707 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6707.xml">
<!ENTITY RFC6793 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6793.xml">
<!ENTITY RFC7285 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7285.xml">
<!ENTITY RFC7336 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7336.xml">
<!ENTITY RFC8006 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8006.xml">
<!ENTITY RFC8008 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8008.xml">
<!ENTITY I-D.ietf-alto-incr-update-sse SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.draft-ietf-alto-incr-update-sse-22.xml">
<!ENTITY I-D.ietf-alto-path-vector SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.draft-ietf-alto-path-vector-10.xml">
<!ENTITY I-D.ietf-alto-unified-props-new SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.draft-ietf-alto-unified-props-new-11.xml">
<!ENTITY RFC7975 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7975.xml">
]>
<rfc submissionType="IETF" docName="draft-ietf-alto-cdni-request-routing-alto-11" category="std" ipr="trust200902">
  <?rfc compact="yes"?>
  <?rfc text-list-symbols="o*+-"?>
  <?rfc subcompact="no"?>
  <?rfc sortrefs="yes"?>
  <?rfc symrefs="yes"?>
  <?rfc strict="yes"?>
  <?rfc toc="yes"?>
  <front>
    <title abbrev="CDNI FCI using ALTO">
      Content Delivery Network Interconnection (CDNI) Request Routing: CDNI Footprint and Capabilities Advertisement using ALTO
    </title>
    <author fullname="Jan Seedorf" initials="J." surname="Seedorf">
      <organization>HFT Stuttgart - Univ. of Applied Sciences</organization>
      <address>
        <postal>
          <street>Schellingstrasse 24</street>
          <street>Stuttgart  70174</street>
          <street>Germany</street>
        </postal>
        <phone>+49-0711-8926-2801</phone>
        <email>jan.seedorf@hft-stuttgart.de</email>
      </address>
    </author>

    <author fullname="Y.R. Yang" initials="Y." surname="Yang">
      <organization abbrev="Tongji/Yale">Yale University/PCL</organization>
      <address>
        <postal>
          <street>51 Prospect Street</street>
          <street>New Haven, CT  06511</street>
          <street>United States of America</street>
        </postal>
        <email>yry@cs.yale.edu</email>
        <uri>http://www.cs.yale.edu/~yry/</uri>
      </address>
    </author>

    <author fullname="Kevin J. Ma" initials="K." surname="Ma">
      <organization>Ericsson</organization>
      <address>
        <postal>
          <street>43 Nagog Park</street>
          <street>Acton, MA  01720</street>
          <street>United States of America</street>
        </postal>
        <phone>+1-978-844-5100</phone>
        <email>kevin.j.ma.ietf@gmail.com</email>
      </address>
    </author>

    <author fullname="Jon Peterson" initials="J." surname="Peterson">
      <organization abbrev="Neustar">NeuStar</organization>
      <address>
        <postal>
          <street>1800 Sutter St Suite 570</street>
          <street>Concord, CA  94520</street>
          <street>United States of America</street>
        </postal>
        <email>jon.peterson@neustar.biz</email>
      </address>
    </author>

    <!-- <author fullname="Xiao Shawn Lin" initials="X." surname="Lin">
      <organization abbrev="Tongji">Tongji University</organization>
      <address>
        <postal>
          <street>4800 Cao'an Hwy</street>
          <street>Shanghai  201804</street>
          <street>China</street>
        </postal>
        <email>x.shawn.lin@gmail.com</email>
      </address>
    </author> -->

    <author fullname="Jingxuan Jensen Zhang" initials="J." surname="Zhang">
      <organization abbrev="Tongji">Tongji University</organization>
      <address>
        <postal>
          <street>4800 Cao'an Hwy</street>
          <street>Shanghai  201804</street>
          <street>China</street>
        </postal>
        <email>jingxuan.zhang@tongji.edu.cn</email>
      </address>
    </author>

    <date/>
    <workgroup>ALTO &amp; CDNI WGs</workgroup>
    <abstract>
      <t>
        The Content Delivery Networks Interconnection (CDNI) framework <xref
        target="RFC6707"/> defines a set of protocols to interconnect CDNs, to
        achieve multiple goals such as extending the reach of a given CDN to
        areas that are not covered by that particular CDN. One component that
        is needed to achieve the goal of CDNI described in <xref
        target="RFC7336"/> is the CDNI Request Routing Footprint &amp;
        Capabilities Advertisement interface (FCI). <xref target="RFC8008"/>
        defines precisely the semantics of FCI and provides guidelines on the
        FCI protocol, but the exact protocol is explicitly outside the scope of
        that document. This document defines an FCI protocol using the
        Application-Layer Traffic Optimization (ALTO) protocol, following the
        guidelines defined in <xref target="RFC8008"/>.
      </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction" anchor="intro">
      <t>
        The ability to interconnect multiple content delivery networks (CDNs)
        has many benefits, including increased coverage, capability, and
        reliability. The Content Delivery Networks Interconnection (CDNI)
        framework <xref target="RFC6707"/> defines four interfaces to
        achieve the interconnection of CDNs: (1) the CDNI Request Routing
        Interface; (2) the CDNI Metadata Interface; (3) the CDNI Logging
        Interface; and (4) the CDNI Control Interface.
      </t>

      <t>
        Among the four interfaces, the CDNI Request Routing Interface
        provides key functions, as specified in <xref target="RFC6707"/>:
        "The CDNI Request Routing interface enables a Request Routing
        function in an Upstream CDN to query a Request Routing function in a
        Downstream CDN to determine if the Downstream CDN is able (and
        willing) to accept the delegated Content Request. It also allows the
        Downstream CDN to control what should be returned to the User Agent
        in the redirection message by the upstream Request Routing function."
        At a high level, the scope of the CDNI Request Routing Interface,
        therefore, contains two main tasks: (1) determining if the dCDN
        (downstream CDN) is willing to accept a delegated content request,
        and (2) redirecting the content request coming from a uCDN (upstream
        CDN) to the proper entry point or entity in the dCDN.
      </t>

      <t>
        Correspondingly, the request routing interface is broadly divided
        into two functionalities: (1) the CDNI Footprint &amp; Capabilities
        Advertisement interface (FCI) defined in <xref target="RFC8008"/>,
        and (2) the CDNI Request Routing Redirection interface (RI) defined
        in <xref target="RFC7975"/>. Since this document focuses on the
        first functionality (CDNI FCI), below is more details about it.
      </t>

      <t>
        Specifically, CDNI FCI allows both an advertisement from a dCDN to a
        uCDN (push) and a query from a uCDN to a dCDN (pull) so that the uCDN
        knows whether it can redirect a particular user request to that dCDN.
      </t>

      <t>
        A key component in defining CDNI FCI is defining objects describing
        the footprints and capabilities of a dCDN. Such objects are already
        defined in <xref target="RFC8008"/>. A protocol to transport and
        update such objects between a uCDN and a dCDN, however, is not
        defined. Hence, the scope of this document is to define such a
        protocol by introducing a new Application-Layer Traffic Optimization
        (ALTO) <xref target="RFC7285"/> service called "CDNI FCI Service".
      </t>

      <t>
        There are multiple benefits in using ALTO as a transport protocol, as
        discussed in <xref target="bgALTO"/>.
      </t>

      <t>
        The rest of this document is organized as follows. <xref
        target="background"/> provides non-normative background on both CDNI
        FCI and ALTO. <xref target="cdnifci"/> introduces the most basic
        service, called "CDNI FCI Service", to realize CDNI FCI using ALTO.
        <xref target="cdnifcinetworkmap"/> demonstrates a key benefit of
        using ALTO: the ability to integrate CDNI FCI with ALTO network maps.
        Such integration provides new granularity to describe footprints.
        <xref target="filteredcdnifci"/> introduces "Filtered CDNI FCI
        Service" to allow a uCDN to get footprints with given capabilities
        instead of getting the full resource, which can be large. <xref
        target="unifiedpropertymap"/> further shows another benefit of using
        ALTO: the ability to query footprint properties using ALTO unified
        properties. In this way, a uCDN can effectively fetch capabilities of
        footprints in which it is interested. IANA and security
        considerations are discussed in <xref target="iana"/> and <xref
        target="security"/> respectively.
      </t>

    </section>

    <section title="Background" anchor="background">
      <t>
        The design of CDNI FCI transport using ALTO depends on the
        understanding of both FCI semantics and ALTO. Hence, this document
        starts with a non-normative review for both. The review uses the
        terminologies for CDNI as defined in <xref target="RFC6707"/>, <xref
        target="RFC8006"/> and <xref target="RFC8008"/>; those for ALTO as
        defined in <xref target="RFC7285"/> and <xref
        target="I-D.ietf-alto-unified-props-new"/>.
      </t>

      <section title="Semantics of FCI Advertisement" anchor="bgSemantics">
        <t>
          <xref target="RFC8008"/> (CDNI "Footprint and Capabilities
          Semantics") defines the semantics of CDNI FCI, provides guidance on
          what Footprint and Capabilities mean in a CDNI context, and
          specifies the requirements on the CDNI FCI transport protocol. The
          definitions in <xref target="RFC8008"/> depend on <xref
          target="RFC8006"/>. Below is a non-normative review of key
          related points of <xref target="RFC8008"/> and <xref
          target="RFC8006"/>. For detailed information and normative
          specification, the reader is referred to these two RFCs.
        </t>

        <t>
          <list style="symbols">
            <t>
              Multiple types of mandatory-to-implement footprints (ipv4cidr,
              ipv6cidr, asn, and countrycode) are defined in <xref
              target="RFC8006"/>. A "Set of IP-prefixes" can contain both
              full IP addresses (i.e., a /32 for IPv4 or a /128 for IPv6) and
              IP prefixes with an arbitrary prefix length. There must also be
              support for multiple IP address versions, i.e., IPv4 and IPv6,
              in such a footprint.
            </t>

            <t>
              Multiple initial types of capabilities are defined in <xref
              target="RFC8008"/> including (1) Delivery Protocol, (2)
              Acquisition Protocol, (3) Redirection Mode, (4) Capabilities
              related to CDNI Logging, and (5) Capabilities related to CDNI
              Metadata. They are required in all cases and therefore
              considered as mandatory-to-implement capabilities for all CDNI
              FCI implementations.
            </t>

            <t>
              Footprint and capabilities are defined together and cannot be
              interpreted independently from each other. Specifically, <xref
              target="RFC8008"/> integrates footprint and capabilities with
              an approach of "capabilities with footprint restrictions", by
              expressing capabilities on a per footprint basis.
            </t>

            <t>
              Specifically, for all mandatory-to-implement footprint types,
              footprints can be viewed as constraints for delegating requests
              to a dCDN: A dCDN footprint advertisement tells the uCDN the
              limitations for delegating a request to the dCDN. For IP
              prefixes or ASN(s), the footprint signals to the uCDN that it
              should consider the dCDN a candidate only if the IP address of
              the request routing source falls within the prefix set (or ASN,
              respectively). The CDNI specifications do not define how a
              given uCDN determines what address ranges are in a particular
              ASN. Similarly, for country codes, a uCDN should only consider
              the dCDN a candidate if it covers the country of the request
              routing source. The CDNI specifications do not define how a
              given uCDN determines the country of the request routing
              source. Multiple footprint constraints are additive, i.e., the
              advertisement of different types of footprint narrows the dCDN
              candidacy cumulatively.
            </t>

            <t>
              Given that a large part of Footprint and Capabilities
              Advertisement may actually happen in contractual agreements,
              the semantics of CDNI Footprint and Capabilities advertisement
              refers to answering the following question: what exactly still
              needs to be advertised by the CDNI FCI? For instance, updates
              about temporal failures of part of a footprint can be useful
              information to convey via the CDNI FCI. Such information would
              provide updates on information previously agreed in contracts
              between the participating CDNs. In other words, the CDNI FCI is
              a means for a dCDN (downstream CDN) to provide changes/updates
              regarding a footprint and/or capabilities that it has prior
              agreed to serve in a contract with a uCDN (upstream CDN).
              Hence, server push and incremental encoding will be necessary
              techniques.
            </t>

          </list>
        </t>

      </section>

      <section title="ALTO Background and Benefits" anchor="bgALTO">
        <t>
          Application-Layer Traffic Optimization (ALTO) <xref
          target="RFC7285"/> defines an approach for conveying network layer
          (topology) information to "guide" the resource provider selection
          process in distributed applications that can choose among several
          candidate resources providers to retrieve a given resource.
          Usually, it is assumed that an ALTO server conveys information that
          these applications cannot measure or have difficulty measuring
          themselves <xref target="RFC5693"/>.
        </t>

        <t>
          Originally, ALTO was motivated by optimizing cross-ISP traffic
          generated by P2P applications <xref target="RFC5693"/>. However,
          ALTO can also be used for improving the request routing in CDNs. In
          particular, the CDNI problem statement <xref target="RFC6707"/>
          explicitly mentions ALTO as a candidate protocol for "actual
          algorithms for selection of CDN or Surrogate by Request-Routing
          systems".
        </t>

        <t>
          The following reasons make ALTO a suitable candidate protocol for
          dCDN (downstream CDN) selection as part of CDNI request routing
          and, in particular, for an FCI protocol:
        </t>

        <t>
          <list style="symbols">
            <t>
              ALTO is a protocol specifically designed to improve application
              layer traffic (and application layer connections among hosts on
              the Internet) by providing additional information to
              applications that these applications could not easily retrieve
              themselves. This matches the need of CDNI: a uCDN wants to
              improve application layer CDN request routing by using
              information (provided by a dCDN) that the uCDN could not easily
              obtain otherwise. Hence, ALTO can help a uCDN to select a
              proper dCDN by first providing dCDNs' capabilities as well as
              footprints (see <xref target="cdnifci"/>) and then providing
              costs of surrogates in a dCDN by ALTO cost maps.
            </t>

            <t>
              The semantics of an ALTO network map is an exact match for the
              needed information to convey a footprint by a dCDN, in
              particular, if such a footprint is being expressed by IP-prefix
              ranges. Please see <xref target="cdnifcinetworkmap"/>.
            </t>

            <t>
              Security: The identification between uCDNs and dCDNs is an
              important requirement. ALTO maps can be signed and hence
              provide inherent integrity protection. Please see <xref
              target="security"/>.
            </t>

            <t>
              RESTful-Design: The ALTO protocol has undergone extensive
              revisions in order to provide a RESTful design regarding the
              client-server interaction specified by the protocol. A CDNI FCI
              interface based on ALTO would inherit this RESTful design.
              Please see <xref target="cdnifci"/>.
            </t>

            <t>
              Error-handling: The ALTO protocol provides extensive
              error-handling in the whole request and response process (see
              Section 8.5 of <xref target="RFC7285"/>). A CDNI FCI interface
              based on ALTO would inherit this this extensive error-handling
              framework. Please see <xref target="filteredcdnifci"/>.
            </t>

            <t>
              Filtered map service: The ALTO map filtering service would
              allow a uCDN to query only for parts of an ALTO map. For
              example, the ALTO filtered property map service can enable a
              uCDN to query properties of a part of footprints efficiently
              (see <xref target="unifiedpropertymap"/>).
            </t>

            <t>
              Server-initiated Notifications and Incremental Updates: When
              the footprint or the capabilities of a dCDN change (i.e.,
              unexpectedly from the perspective of a uCDN), server-initiated
              notifications would enable a dCDN to inform a uCDN about such
              changes directly. Consider the case where - due to failure -
              part of the footprint of the dCDN is not functioning, i.e., the
              CDN cannot serve content to such clients with reasonable QoS.
              Without server-initiated notifications, the uCDN might still
              use a recent network and cost map from the dCDN, and therefore
              redirect requests to the dCDN which it cannot serve. Similarly,
              the possibility for incremental updates would enable efficient
              conveyance of the aforementioned (or similar) status changes by
              the dCDN to the uCDN. The newest design of ALTO supports server
              pushed incremental updates <xref
              target="I-D.ietf-alto-incr-update-sse"/>.
            </t>

            <t>
              Content Availability on Hosts: A dCDN might want to express CDN
              capabilities in terms of certain content types (e.g., codecs/
              formats, or content from certain content providers). The new
              endpoint property for ALTO would enable a dCDN to make such
              information available to a uCDN. This would enable a uCDN to
              determine whether a dCDN actually has the capabilities for a
              given type of content requested.
            </t>

            <t>
              Resource Availability on Hosts or Links: The capabilities on
              links (e.g., maximum bandwidth) or caches (e.g., average load)
              might be useful information for a uCDN for optimized dCDN
              selection. For instance, if a uCDN receives a streaming request
              for content with a certain bitrate, it needs to know if it is
              likely that a dCDN can fulfill such stringent application-level
              requirements (i.e., can be expected to have enough consistent
              bandwidth) before it redirects the request. In general, if ALTO
              could convey such information via new endpoint properties, it
              would enable more sophisticated means for dCDN selection with
              ALTO. ALTO Path Vector Extension <xref
              target="I-D.ietf-alto-path-vector"/> is designed to allow ALTO
              clients to query information such as capacity regions for a
              given set of flows.
            </t>

          </list>
        </t>

      </section>

    </section>

    <section title="CDNI FCI Service" anchor="cdnifci">
      <t>
        The ALTO protocol is based on an ALTO Information Service Framework
        which consists of several services, where all ALTO services are
        "provided through a common transport protocol, messaging structure
        and encoding, and transaction model" <xref target="RFC7285"/>. The
        ALTO protocol specification <xref target="RFC7285"/> defines several
        such services, e.g., the ALTO map service.
      </t>

      <t>
        This document defines a new ALTO Service called "CDNI FCI Service"
        which conveys JSON objects of media type
        "application/alto-cdnifci+json". These JSON objects are used to
        transport BaseAdvertisementObject objects defined in <xref
        target="RFC8008"/>; this document specifies how to transport such
        BaseAdvertisementObject objects via the ALTO protocol with the ALTO
        "CDNI FCI Service". Similar to other ALTO services, this document
        defines the ALTO information resource for the "CDNI FCI Service" as
        follows.
      </t>

      <section title="Media Type" anchor="cdnifcimediatype">
        <t>
          The media type of the CDNI FCI resource is
          "application/alto-cdnifci+json".
        </t>
      </section>

      <section title="HTTP Method" anchor="cdnifcimethod">
        <t>
          A CDNI FCI resource is requested using the HTTP GET method.
        </t>
      </section>

      <section title="Accept Input Parameters" anchor="cdnifciinput">
        <t>
          None.
        </t>
      </section>

      <section title="Capabilities" anchor="cdnifcicap">
        <t>
          None.
        </t>
      </section>

      <section title="Uses" anchor="cdnifciuses">
        <t>
          The "uses" field SHOULD NOT appear unless the CDNI FCI resource
          depends on some ALTO information resources. If the CDNI FCI
          resource has some dependent resources, the resource IDs of its
          dependent resources MUST be included into the "uses" field. This
          document only defines one potential dependent resource for the CDNI
          FCI resource. See <xref target="cdnifcinetworkmap"/> for details
          of when and how to use it. Future documents may extend the CDNI FCI
          resource and allow other dependent resources.
        </t>

      </section>

      <section title="Response" anchor="cdnifciencoding">
        <t>
          The "meta" field of a CDNI FCI response MUST include the "vtag"
          field defined in Section 10.3 of <xref target="RFC7285"/>. This
          field provides the version of the retrieved CDNI FCI resource.
        </t>

        <t>
          If a CDNI FCI response depends on an ALTO information resource, it
          MUST include the "dependent-vtags" field, whose value is an array
          to indicate the version tags of the resources used, where each
          resource is specified in "uses" of its IRD entry.
        </t>

        <t>
          The data component of an ALTO CDNI FCI response is named
          "cdni-fci", which is a JSON object of type CDNIFCIData:
        </t>

        <figure>
          <artwork>
            <![CDATA[
    object {
        CDNIFCIData cdni-fci;
    } InfoResourceCDNIFCI : ResponseEntityBase;

    object {
        BaseAdvertisementObject capabilities<1..*>;
    } CDNIFCIData;
]]>
          </artwork>
        </figure>
        <t>
          Specifically, a CDNIFCIData object is a JSON object that includes
          only one property named "capabilities", whose value is an array of
          BaseAdvertisementObject objects.
        </t>

        <t>
          The syntax and semantics of BaseAdvertisementObject are well
          defined in Section 5.1 of <xref target="RFC8008"/>. A
          BaseAdvertisementObject object includes multiple properties,
          including capability-type, capability- value, and footprints, where
          footprints are defined in Section 4.2.2.2 of <xref
          target="RFC8006"/>.
        </t>

        <t>
          To be self-contained, below is a non-normative specification of
          BaseAdvertisementObject. As mentioned above, the normative
          specification of BaseAdvertisementObject is in <xref
          target="RFC8008"/>.
        </t>

        <figure>
          <artwork>
            <![CDATA[
    object {
        JSONString capability-type;
        JSONValue capability-value;
        Footprint footprints<0..*>;
    } BaseAdvertisementObject;

    object {
        JSONString footprint-type;
        JSONString footprint-value<1..*>;
    } Footprint;
]]>
          </artwork>
        </figure>
        <t>
          For each BaseAdvertisementObject, the ALTO client MUST interpret
          footprints appearing multiple times as if they appeared only once.
          If footprints in a BaseAdvertisementObject is null or empty or not
          appearing, the ALTO client MUST understand that the capabilities in
          this BaseAdvertisementObject have the "global" coverage.
        </t>

        <t>
          Note: Further optimization of BaseAdvertisement objects to
          effectively provide the advertisement of capabilities with
          footprint restrictions is certainly possible. For example, these
          two examples below both describe that the dCDN can provide
          capabilities ["http/1.1", "https/1.1"] for the same footprints.
          However, the latter one is smaller in its size.
        </t>

        <figure>
          <artwork>
            <![CDATA[
EXAMPLE 1
    {
      "meta" : {...},
      "cdni-fci": {
        "capabilities": [
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          },
          {

            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "https/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          }
        ]
      }
    }

EXAMPLE 2
    {
      "meta" : {...},
      "cdni-fci": {
        "capabilities": [
          {
            "capability-type": "FCI.DeliveryProtocol",
            "capability-value": {
              "delivery-protocols": [
                "https/1.1",
                "http/1.1"
              ]
            },
            "footprints": [
              <Footprint objects>
            ]
          }
        ]
      }
    }
]]>
          </artwork>
        </figure>
        <t>
          Since such optimizations are not required for the basic
          interconnection of CDNs, the specifics of such mechanisms are
          outside the scope of this document.
        </t>

      </section>

      <section title="Examples" anchor="cdnifciexamples">
        <section title="IRD Example" anchor="IRDexample">
          <t>
            Below is the information resource directory (IRD) of a simple,
            example ALTO server. The server provides both base ALTO
            information resources (e.g., network maps) and CDNI FCI related
            information resources (e.g., CDNI FCI resource), demonstrating a
            single, integrated environment.
          </t>

          <t>
            Specifically, the IRD announces two network maps, one CDNI FCI
            resource without dependency, one CDNI FCI resource depending on a
            network map, one filtered CDNI FCI resource to be defined in
            <xref target="filteredcdnifci"/>, one property map including
            "cdni-fci-capabilities" as its entity property, one filtered
            property map including "cdni-fci-capabilities" and "pid" as its
            entity properties, and two update stream services (one for
            updating CDNI FCI resources, and the other for updating property
            maps).
          </t>

          <figure>
            <artwork>
              <![CDATA[
 GET /directory HTTP/1.1
 Host: alto.example.com
 Accept: application/alto-directory+json,application/alto-error+json

 HTTP/1.1 200 OK
 Content-Length: 3650
 Content-Type: application/alto-directory+json

 {
   "meta" : {
     "default-alto-network-map": "my-default-network-map"
   },
   "resources": {
     "my-default-network-map": {
       "uri" : "http://alto.example.com/networkmap",
       "media-type" : "application/alto-networkmap+json"
     },
     "my-eu-netmap" : {
       "uri" : "http://alto.example.com/myeunetmap",
       "media-type" : "application/alto-networkmap+json"
     },
     "my-default-cdnifci": {
       "uri" : "http://alto.example.com/cdnifci",
       "media-type": "application/alto-cdnifci+json"
     },
     "my-cdnifci-with-pid-footprints": {
       "uri" : "http://alto.example.com/networkcdnifci",
       "media-type" : "application/alto-cdnifci+json",
       "uses" : [ "my-eu-netmap" ]
     },
     "my-filtered-cdnifci" : {
       "uri" : "http://alto.example.com/cdnifci/filtered",
       "media-type" : "application/alto-cdnifci+json",
       "accepts" : "application/alto-cdnifcifilter+json",
       "uses" : [ "my-default-cdnifci" ]
     },
     "cdnifci-property-map" : {
       "uri" : "http://alto.example.com/propmap/full/cdnifci",
       "media-type" : "application/alto-propmap+json",
       "uses": [ "my-default-cdni" ],
       "capabilities" : {
         "mappings": {
           "ipv4": [ "my-default-cdni.cdni-fci-capabilities" ],
           "ipv6": [ "my-default-cdni.cdni-fci-capabilities" ],
           "countrycode": [

             "my-default-cdni.cdni-fci-capabilities" ],
           "asn": [ "my-default-cdni.cdni-fci-capabilities" ],
         }
       }
     },
     "filtered-cdnifci-property-map" : {
       "uri" : "http://alto.example.com/propmap/lookup/cdnifci-pid",
       "media-type" : "application/alto-propmap+json",
       "accepts" : "application/alto-propmapparams+json",
       "uses": [ "my-default-cdni", "my-default-network-map" ],
       "capabilities" : {
         "mappings": {
           "ipv4": [ "my-default-cdni.cdni-fci-capabilities",
                     "my-default-network-map.pid" ],
           "ipv6": [ "my-default-cdni.cdni-fci-capabilities",
                     "my-default-network-map.pid" ],
           "countrycode": [
             "my-default-cdni.cdni-fci-capabilities" ],
           "asn": [ "my-default-cdni.cdni-fci-capabilities" ],
         }
       }
     },
     "update-my-cdni-fci" : {
       "uri": "https:///alto.example.com/updates/cdnifci",
       "media-type" : "text/event-stream",
       "accepts" : "application/alto-updatestreamparams+json",
       "uses" : [
         "my-default-network-map",
         "my-eu-netmap",
         "my-default-cdnifci",
         "my-filtered-cdnifci",
         "my-cdnifci-with-pid-footprints"
       ],
       "capabilities" : {
         "incremental-change-media-types" : {
          "my-default-network-map" : "application/json-patch+json",
          "my-eu-netmap" : "application/json-patch+json",
          "my-default-cdnifci" :
          "application/merge-patch+json,application/json-patch+json",
          "my-filtered-cdnifci" :
          "application/merge-patch+json,application/json-patch+json",
          "my-cdnifci-with-pid-footprints" :
          "application/merge-patch+json,application/json-patch+json"
         }
       }
     },
     "update-my-props": {
       "uri" : "https://alto.example.com/updates/properties",
       "media-type" : "text/event-stream",
       "uses" : [
         "cdnifci-property-map",
         "filtered-cdnifci-property-map"
       ],
       "capabilities" : {
         "incremental-change-media-types": {
          "cdnifci-property-map" :
          "application/merge-patch+json,application/json-patch+json",
          "filtered-cdnifci-property-map":
          "application/merge-patch+json,application/json-patch+json"
         }
       }
     }
   }
 }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Basic Example" anchor="fullcdnifciexample">
          <t>
            This basic example demonstrates a simple CDNI FCI resource, which
            does not depend on other resources. There are three
            BaseAdvertisementObjects in this resource and these objects'
            capabilities are http/1.1 delivery protocol, [http/1.1,
            https/1.1] delivery protocol, and https/1.1 acquisition protocol,
            respectively.
          </t>

          <figure>
            <artwork>
              <![CDATA[
  GET /cdnifci HTTP/1.1
  Host: alto.example.com
  Accept: application/alto-cdnifci+json,
          application/alto-error+json

  HTTP/1.1 200 OK
  Content-Length: 1209
  Content-Type: application/alto-cdnifci+json

  {
    "meta" : {
      "vtag": {
        "resource-id": "my-default-cdnifci",
        "tag": "da65eca2eb7a10ce8b059740b0b2e3f8eb1d4785"
      }
    },
    "cdni-fci": {
      "capabilities": [
        {
          "capability-type": "FCI.DeliveryProtocol",
          "capability-value": {
            "delivery-protocols": [
              "http/1.1"
            ]
          },
          "footprints": [
            {
              "footprint-type": "ipv4cidr",
              "footprint-value": [ "192.0.2.0/24" ]
            }
          ]
        },
        {
          "capability-type": "FCI.DeliveryProtocol",
          "capability-value": {
            "delivery-protocols": [
              "https/1.1",
              "http/1.1"
            ]
          },
          "footprints": [
            {
              "footprint-type": "ipv4cidr",
              "footprint-value": [ "198.51.100.0/24" ]
            }
          ]
        },
        {
          "capability-type": "FCI.AcquisitionProtocol",
          "capability-value": {
            "acquisition-protocols": [
              "https/1.1"
            ]
          },
          "footprints": [
            {
              "footprint-type": "ipv4cidr",
              "footprint-value": [ "203.0.113.0/24" ]
            }
          ]
        }
      ]
    }
  }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Incremental Updates Example">
          <t>
            A benefit of using ALTO to provide CDNI FCI resources is that
            such resources can be updated using ALTO incremental updates.
            Below is an example that also shows the benefit of having both
            JSON merge patch and JSON patch to encode updates.
          </t>

          <t>
            At first, an ALTO client requests updates for
            "my-default-cdnifci", and the ALTO server returns the
            "control-uri" followed by the full CDNI FCI response. Then when
            there is a change in the delivery-protocols in that http/1.1 is
            removed (from [http/1.1, https/1.1] to only https/1.1) due to
            maintenance of the https/1.1 clusters, the ALTO server
            regenerates the new CDNI FCI resource and pushes the full
            replacement to the ALTO client. Later on, the ALTO server
            notifies the ALTO client that "192.0.2.0/24" is added into the
            "ipv4" footprint object for delivery-protocol https/1.1 by
            sending the change encoded by JSON patch to the ALTO client.
          </t>

          <figure>
            <artwork>
              <![CDATA[
 POST /updates/cdnifci HTTP/1.1
 Host: alto.example.com
 Accept: text/event-stream,application/alto-error+json
 Content-Type: application/alto-updatestreamparams+json
 Content-Length: 92

 { "add": {
     "my-cdnifci-stream": {
       "resource-id": "my-default-cdnifci"
     }
   }
 }

 HTTP/1.1 200 OK
 Connection: keep-alive
 Content-Type: text/event-stream

 event: application/alto-updatestreamcontrol+json
 data: {"control-uri":
 data: "https://alto.example.com/updates/streams/3141592653589"}

 event: application/alto-cdnifci+json,my-cdnifci-stream
 data: { ... full CDNI FCI resource ... }

 event: application/alto-cdnifci+json,my-cdnifci-stream
 data: {
 data:   "meta": {
 data:     "vtag": {
 data:       "tag": "dasdfa10ce8b059740bddsfasd8eb1d47853716"
 data:     }
 data:   },
 data:   "cdni-fci": {
 data:     "capabilities": [
 data:       {
 data:         "capability-type": "FCI.DeliveryProtocol",
 data:         "capability-value": {
 data:           "delivery-protocols": [
 data:             "https/1.1"
 data:           ]
 data:         },
 data:         "footprints": [
 data:           { "footprint-type": "ipv4cidr",
 data:             "footprint-value": [ "203.0.113.0/24" ]
 data:           }
 data:         ]
 data:       },
 data:       { ... other FCI advertisement object ... }
 data:     ]
 data:   }
 data: }

 event: application/json-patch+json,my-cdnifci-stream
 data: [
 data:   { "op": "replace",
 data:     "path": "/meta/vtag/tag",
 data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
 data:   },
 data:   { "op": "add",
 data:     "path":
 data:     "/cdni-fci/capabilities/0/footprints/0/footprint-value/-",
 data:     "value": "192.0.2.0/24"
 data:   }
 data: ]
]]>
            </artwork>
          </figure>
        </section>

      </section>

    </section>

    <section title="CDNI FCI Service using ALTO Network Map" anchor="cdnifcinetworkmap">
      <section title="Network Map Footprint Type: altopid">
        <t>
          The ALTO protocol defines a concept called PID to represent a group
          of IPv4 or IPv6 addresses which can be applied the same management
          policy. The PID is an alternative to the pre-defined CDNI footprint
          types (i.e., ipv4cidr, ipv6cidr, asn, and countrycode).
        </t>
        <t>
          Specifically, a CDNI FCI resource can depend on an ALTO network map
          resource and use a new CDNI Footprint Type called "altopid" to
          compress its CDNI Footprint Payload.
        </t>

        <t>
          Specifically, the "altopid" footprint type indicates that the
          corresponding footprint value is a list of PIDNames as defined in
          <xref target="RFC7285"/>. These PIDNames are references of PIDs
          in a network map resource. Hence a CDNI FCI with "altopid"
          footprints depends on a network map. For such a CDNI FCI map, the
          resource id of its dependent network map MUST be included in the
          "uses" field of its IRD entry, and the "dependent-vtag" field with
          a reference to this network map MUST be included in its response
          (see the example in <xref target="networkmapfootprint"/>).
        </t>

      </section>

      <section title="Examples">
        <section title="IRD Example">
          <t>
            The examples below use the same IRD given in <xref
            target="IRDexample"/>.
          </t>
        </section>

        <section title="ALTO Network Map for CDNI FCI Footprints Example" anchor="networkmapexample">
          <t>
            Below is an example network map whose resource id is
            "my-eu-netmap", and this map is referenced by the CDNI FCI
            example in <xref target="networkmapfootprint"/>.
          </t>

          <figure>
            <artwork>
              <![CDATA[
 GET /myeunetmap HTTP/1.1
 Host: alto.example.com
 Accept: application/alto-networkmap+json,application/alto-error+json

 HTTP/1.1 200 OK
 Content-Length: 309
 Content-Type: application/alto-networkmap+json

 {
   "meta": {
     "vtag": [
       { "resource-id": "my-eu-netmap",
         "tag": "3ee2cb7e8d63d9fab71b9b34cbf764436315542e"
       }
     ]
   },
   "network-map": {
     "south-france" : {
       "ipv4": [ "192.0.2.0/24", "198.51.100.0/25" ]
     },
     "germany": {
       "ipv4": [ "203.0.113.0/24" ]
     }
   }
 }
]]>
            </artwork>
          </figure>
        </section>

        <section title="ALTO PID Footprints in CDNI FCI" anchor="networkmapfootprint">
          <t>
            This example shows a CDNI FCI resource that depends on a network
            map described in <xref target="networkmapexample"/>.
          </t>

          <figure>
            <artwork>
              <![CDATA[
 GET /networkcdnifci HTTP/1.1
 Host: alto.example.com
 Accept: application/alto-cdnifci+json,application/alto-error+json

 HTTP/1.1 200 OK
 Content-Length: 712
 Content-Type: application/alto-cdnifci+json

 {
   "meta" : {
     "dependent-vtags" : [
       {
         "resource-id": "my-eu-netmap",
         "tag": "3ee2cb7e8d63d9fab71b9b34cbf764436315542e"
       }
     ]
   },
   "cdni-fci": {
     "capabilities": [
       { "capability-type": "FCI.DeliveryProtocol",
         "capability-value": [ "https/1.1" ],
         "footprints": [
           { "footprint-type": "altopid",
             "footprint-value": [ "south-france" ]
           }
         ]
       },
       { "capability-type": "FCI.AcquisitionProtocol",
         "capability-value": [ "https/1.1" ],
         "footprints": [
           { "footprint-type": "altopid",
             "footprint-value": [ "germany", "south-france" ]
           }
         ]
       }
     ]
   }
 }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Incremental Updates Example">
          <t>
            In this example, the ALTO client is interested in changes of
            "my-cdnifci-with-pid-footprints" and its dependent network map
            "my-eu-netmap". Considering two changes, the first one is to
            change footprints of the https/1.1 delivery protocol capability,
            and the second one is to remove "south-france" from the
            footprints of the https/1.1 acquisition protocol capability.
          </t>

          <figure>
            <artwork>
              <![CDATA[
  POST /updates/cdnifci HTTP/1.1
  Host: alto.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: 183

  { "add": {
      "my-eu-netmap-stream": {
        "resource-id": "my-eu-netmap"
      },
      "my-netmap-cdnifci-stream": {
        "resource-id": "my-cdnifci-with-pid-footprints"
      }
    }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "https://alto.example.com/updates/streams/3141592653590"}

  event: application/alto-networkmap+json,my-eu-netmap-stream
  data: { ... full Network Map of my-eu-netmap ... }

  event: application/alto-cdnifci+json,my-netmap-cdnifci-stream
  data: { ... full CDNI FCI resource ... }

  event: application/json-patch+json,my-netmap-cdnifci-stream
  data: [
  data:   { "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "dasdfa10ce8b059740bddsfasd8eb1d47853716"
  data:   },
  data:   { "op": "add",
  data:     "path":
  data:     "/cdni-fci/capabilities/0/footprints/0/footprint-value/-",
  data:     "value": "germany"
  data:   }
  data: ]

  event: application/json-patch+json,my-netmap-cdnifci-stream
  data: [
  data:   { "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
  data:   },
  data:   { "op": "remove",
  data:     "path":
  data:     "/cdni-fci/capabilities/1/footprints/0/footprint-value/1"
  data:   }
  data: ]
]]>
            </artwork>
          </figure>
        </section>

      </section>

    </section>

    <section title="Filtered CDNI FCI using Capabilities" anchor="filteredcdnifci">

      <t>
        <xref target="cdnifci"/> and <xref target="cdnifcinetworkmap"/>
        describe CDNI FCI Service which can be used to enable a uCDN to get
        capabilities with footprints constraints from dCDNs. However, since
        always getting full CDNI FCI resources from dCDNs is inefficient,
        this document introduces a new service named "Filtered CDNI FCI
        Service", to allow a client to filter a CDNI FCI resource using a
        client-given set of capabilities. For each entry of the CDNI FCI
        response, an entry will only be returned to the client if it contains
        at least one of the client given capabilities. The relationship
        between a filtered CDNI FCI resource and a CDNI FCI resource is
        similar to the relationship between a filtered network/ cost map and
        a network/cost map.
      </t>

      <section title="Media Type">

        <t>
          A filtered CDNI FCI resource uses the same media type defined for
          the CDNI FCI resource in <xref target="cdnifcimediatype"/>.
        </t>

      </section>

      <section title="HTTP Method">
        <t>
          A filtered CDNI FCI resource is requested using the HTTP POST
          method.
        </t>
      </section>

      <section title="Accept Input Parameters">
        <t>
          The input parameters for a filtered CDNI FCI resource are supplied
          in the entity body of the POST request. This document specifies the
          input parameters with a data format indicated by the media type
          "application/alto-cdnifcifilter+json" which is a JSON object of
          type ReqFilteredCDNIFCI, where:
        </t>

        <figure>
          <artwork>
            <![CDATA[
   object {
       JSONString capability-type;
       JSONValue capability-value;
   } CDNIFCICapability;

   object {
       [CDNIFCICapability cdni-fci-capabilities<0..*>;]
   } ReqFilteredCDNIFCI;

]]>
          </artwork>
        </figure>
        <t>
          with fields:
          <list style="hanging" hangIndent="3">
            <t hangText="capability-type:">
              The same as Base Advertisement Object's capability-type defined
              in Section 5.1 of <xref target="RFC8008"/>.
            </t>

            <t hangText="capability-value:">
              The same as Base Advertisement Object's capability-value
              defined in Section 5.1 of <xref target="RFC8008"/>.
            </t>

            <t hangText="cdni-fci-capabilities:">
              A list of CDNI FCI capabilities defined in Section 5.1 of <xref
              target="RFC8008"/> for which footprints are to be returned. If
              a list is empty or not appearing, the ALTO server MUST
              interpret it as a request for the full CDNI FCI resource. The
              ALTO server MUST interpret entries appearing in a list multiple
              times as if they appeared only once. If the ALTO server does
              not define any footprints for a CDNI capability, it MUST omit
              this capability from the response.
            </t>
          </list>
        </t>

      </section>

      <section title="Capabilities">
        <t>
          None.
        </t>

      </section>

      <section title="Uses">
        <t>
          The resource ID of the CDNI FCI resource based on which the
          filtering is performed.
        </t>

      </section>

      <section title="Response">
        <t>
          The response MUST indicate an error, using ALTO protocol error
          handling specified in Section 8.5 of the ALTO protocol <xref
          target="RFC7285"/>, if the request is invalid.
        </t>

        <t>
          Specifically, a filtered CDNI FCI request is invalid if:
        </t>

        <t>
          <list style="symbols">
            <t>the value of "capability-type" is null;</t>

            <t>the value of "capability-value" is null;</t>

            <t>the value of "capability-value" is inconsistent with "capability-type".</t>

          </list>
        </t>

        <t>
          When a request is invalid, the ALTO server MUST return an
          "E_INVALID_FIELD_VALUE" error defined in Section 8.5.2 of <xref
          target="RFC7285"/>, and the "value" field of the error message
          SHOULD indicate this CDNI FCI capability.
        </t>

        <t>
          The ALTO server returns a filtered CDNI FCI resource for a valid
          request. The format of a filtered CDNI FCI resource is the same as
          a full CDNI FCI resource (See <xref target="cdnifciencoding"/>.)
        </t>

        <t>
          The returned CDNI FCI resource MUST contain only
          BaseAdvertisementObject objects whose CDNI capability object is the
          superset of one of CDNI capability object in
          "cdni-fci-capabilities". Specifically, that a CDNI capability
          object A is the superset of another CDNI capability object B means
          that these two CDNI capability objects have the same capability
          type and mandatory properties in capability value of A MUST include
          mandatory properties in capability value of B semantically. See
          <xref target="filteredcdnifciexample"/> for a concrete example.
        </t>

        <t>
          The version tag included in the "vtag" field of the response MUST
          correspond to the full CDNI FCI resource from which the filtered
          CDNI FCI resource is provided. This ensures that a single,
          canonical version tag is used independently of any filtering that
          is requested by an ALTO client.
        </t>

      </section>

      <section title="Examples">

        <section title="IRD Example">
          <t>
            The examples below use the same IRD example as in <xref
            target="IRDexample"/>.
          </t>

        </section>

        <section title="Basic Example" anchor="filteredcdnifciexample">
          <t>
            This example filters the full CDNI FCI resource in <xref
            target="fullcdnifciexample"/> by selecting only the http/1.1
            delivery protocol capability. Only the second
            BaseAdvertisementObjects in the full resource will be returned
            because the second object's capability is http/1.1 and https/1.1
            delivery protocols which is the superset of https/1.1 delivery
            protocol.
          </t>

          <figure>
            <artwork>
              <![CDATA[
  POST /cdnifci/filtered HTTP/1.1
  HOST: alto.example.com
  Accept: application/alto-cdnifci+json
  Content-Type: application/cdnifilter+json
  Content-Length: 180

  {
    "cdni-fci-capabilities": [
      {
        "capability-type": "FCI.DeliveryProtocol",
        "capability-value": {
          "delivery-protocols": [ "https/1.1" ]
        }
      }
    ]
  }

  HTTP/1.1 200 OK
  Content-Length: 544
  Content-Type: application/alto-cdnifci+json

  {
    "meta" : {
      "vtag": {
        "resource-id": "my-default-cdnifci",
        "tag": "da65eca2eb7a10ce8b059740b0b2e3f8eb1d4785"
      }
    },
    "cdni-fci": {
      "capabilities": [
        {
          "capability-type": "FCI.DeliveryProtocol",
          "capability-value": {
            "delivery-protocols": [
              "https/1.1",
              "http/1.1"
            ]
          },
          "footprints": [
            {
              "footprint-type": "ipv4cidr",
              "footprint-value": [ "198.51.100.0/24" ]
            }
          ]
        }
      ]
    }
  }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Incremental Updates Example">
          <t>
            In this example, the ALTO client only cares about the updates of
            one advertisement object for delivery protocol capability whose value includes "https/1.1". So
            it adds its limitation of capabilities in "input" field of the
            POST request.
          </t>

          <figure>
            <artwork>
              <![CDATA[
  POST /updates/cdnifci HTTP/1.1
  Host: fcialtoupdate.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: 350

  {
    "add": {
      "my-filtered-fci-stream": {
        "resource-id": "my-filtered-cdnifci",
        "input": {
          "cdni-fci-capabilities": [
            {
              "capability-type": "FCI.DeliveryProtocol",
              "capability-value": {
                "delivery-protocols": [ "https/1.1" ]
              }
            }
          ]
        }
      }
    }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "https://alto.example.com/updates/streams/3141592653590"}

  event: application/alto-cdnifci+json,my-filtered-fci-stream
  data: { ... filtered CDNI FCI resource ... }

  event: application/json-patch+json,my-filtered-fci-stream
  data: [
  data:   {
  data:     "op": "replace",
  data:     "path": "/meta/vtag/tag",
  data:     "value": "a10ce8b059740b0b2e3f8eb1d4785acd42231bfe"
  data:   },
  data:   { "op": "add",
  data:     "/cdni-fci/capabilities/0/footprints/0/footprint-value/-",
  data:     "value": "192.0.2.0/24"
  data:   }
  data: ]
]]>
            </artwork>
          </figure>
        </section>

      </section>

    </section>

    <section title="Query Footprint Properties using ALTO Property Map Service" anchor="unifiedpropertymap">
      <t>
        Besides the requirement of retrieving footprints of given
        capabilities, another common requirement for uCDN is to query CDNI
        capabilities of given footprints.
      </t>

      <t>
        Considering each footprint as an entity with properties including
        CDNI capabilities, a natural way to satisfy this requirement is to
        use the ALTO property map as defined in <xref
        target="I-D.ietf-alto-unified-props-new"/>. This section describes
        how ALTO clients look up properties for individual footprints. First,
        it describes how to represent footprint objects as entities in the
        ALTO property map. Second, it provides examples of the full property
        map and the filtered property map supporting CDNI capabilities, and
        their incremental updates.
      </t>

      <section title="Representing Footprint Objects as Property Map Entities" anchor="footprinttoentities">
        <t>
          A footprint object has two properties: footprint-type and
          footprint- value. A footprint-value is an array of footprint values
          conforming to the specification associated with the registered
          footprint type ("ipv4cidr", "ipv6cidr", "asn", and "countrycode").
          Considering each ALTO entity defined in <xref
          target="I-D.ietf-alto-unified-props-new"/> also has two
          properties: entity domain type and domain-specific identifier, a
          straightforward approach to represent a footprint as an ALTO entity
          is to regard its footprint-type as an entity domain type, and its
          footprint value as a domain-specific identifier. According to <xref
          target="I-D.ietf-alto-unified-props-new"/>, "ipv4" and "ipv6" are
          two predefined entity domain types, which can be used to represent
          "ipv4cidr" and "ipv6cidr" footprints respectively. However, no
          existing entity domain type can represent "asn" and "countrycode"
          footprints. To represent footprint-type "asn" and "countrycode",
          this document registers two new domains in <xref target="iana"/>
          in addition to the ones in <xref
          target="I-D.ietf-alto-unified-props-new"/>.
        </t>

        <t>
          Here is an example of representing a footprint object as a set of
          entities in the ALTO property map.
        </t>

        <figure>
          <artwork>
            <![CDATA[
{ "footprint-type": "ipv4cidr",
  "footprint-value": ["192.0.2.0/24", "198.51.100.0/24"]
} --> "ipv4:192.0.2.0/24", "ipv4:198.51.100.0/24"
]]>
          </artwork>
        </figure>
        <section title="ASN Domain">
          <t>
            The ASN domain associates property values with Autonomous Systems
            in the Internet.
          </t>

          <section title="Entity Domain Type">
            <t>
              asn
            </t>

          </section>

          <section title="Domain-Specific Entity Identifiers" anchor="asn-entity-id">
            <t>
              The entity identifier of an entity in an asn domain is encoded
              as a string consisting of the characters "as" (in lowercase)
              followed by the Autonomous System Number <xref
              target="RFC6793"/>.
            </t>

          </section>

          <section title="Hierarchy and Inheritance">
            <t>
              There is no hierarchy or inheritance for properties associated
              with ASN.
            </t>

          </section>

        </section>

        <section title="COUNTRYCODE Domain">
          <t>
            The COUNTRYCODE domain associates property values with
            countries.
          </t>

          <section title="Entity Domain Type">
            <t>
              countrycode
            </t>

          </section>

          <section title="Domain-Specific Entity Identifiers" anchor="countrycode-entity-id">
            <t>
              The entity identifier of an entity in a countrycode domain is
              encoded as an ISO 3166-1 alpha-2 code <xref
              target="ISO3166-1"/> in lowercase.
            </t>

          </section>

          <section title="Hierarchy and Inheritance">
            <t>
              There is no hierarchy or inheritance for properties associated
              with country codes.
            </t>

          </section>

        </section>

      </section>

      <section title="Examples">
        <section title="IRD Example">
          <t>
            The examples use the same IRD example given by <xref
            target="IRDexample"/>.
          </t>

        </section>

        <section title="Property Map Example">
          <t>
            This example shows a full property map in which entities are
            footprints and entities' property is "cdni-fci-capabilities".
          </t>

          <figure>
            <artwork>
              <![CDATA[
 GET /propmap/full/cdnifci HTTP/1.1
 HOST: alto.example.com
 Accept: application/alto-propmap+json,application/alto-error+json

 HTTP/1.1 200 OK
 Content-Length: 1546
 Content-Type: application/alto-propmap+json

 {
   "property-map": {
     "meta": {
       "dependent-vtags": [
         { "resource-id": "my-default-cdnifci",
           "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf62"}
       ]
     },
     "countrycode:us": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.DeliveryProtocol",
           "capability-value": {
             "delivery-protocols": ["http/1.1"]}}]
     },
     "ipv4:192.0.2.0/24": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.DeliveryProtocol",
           "capability-value": {
             "delivery-protocols": ["http/1.1"]}}]
     },
     "ipv4:198.51.100.0/24": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.DeliveryProtocol",
           "capability-value": {
             "delivery-protocols": ["https/1.1", "http/1.1"]}}]
     },
     "ipv4:203.0.113.0/24": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.AcquisitionProtocol",
           "capability-value": {
             "acquisition-protocols": ["http/1.1"]}}]
     },
     "ipv6:2001:db8::/32": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.DeliveryProtocol",
           "capability-value": {
             "delivery-protocols": ["http/1.1"]}}]
     },
     "asn:as64496": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         { "capability-type": "FCI.DeliveryProtocol",
           "capability-value": {
             "delivery-protocols": ["https/1.1", "http/1.1"]}}]
     }
   }
 }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Filtered Property Map Example">
          <t>
            This example uses the filtered property map service to get "pid"
            and "cdni-fci-capabilities" properties for two footprints
            "ipv4:192.0.2.0/24" and "ipv6:2001:db8::/32".
          </t>

          <figure>
            <artwork>
              <![CDATA[
   POST /propmap/lookup/cdnifci-pid HTTP/1.1
   HOST: alto.example.com
   Content-Type: application/alto-propmapparams+json
   Accept: application/alto-propmap+json,application/alto-error+json
   Content-Length: 185

   {
     "entities": [
       "ipv4:192.0.2.0/24",
       "ipv6:2001:db8::/32"
     ],
     "properties": [ "my-default-cdnifci.cdni-fci-capabilities",
                     "my-default-networkmap.pid" ]
   }

 HTTP/1.1 200 OK
 Content-Length: 804
 Content-Type: application/alto-propmap+json

 {
   "property-map": {
     "meta": {
       "dependent-vtags": [
          {"resource-id": "my-default-cdnifci",
            "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf62"},
          {"resource-id": "my-default-networkmap",
            "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf63"}
       ]
     },
     "ipv4:192.0.2.0/24": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         {"capability-type": "FCI.DeliveryProtocol",
          "capability-value": {"delivery-protocols": ["http/1.1"]}}],
       "my-default-networkmap.pid": "pid1"
     },
     "ipv6:2001:db8::/32": {
       "my-default-cdnifci.cdni-fci-capabilities": [
         {"capability-type": "FCI.DeliveryProtocol",
          "capability-value": {"delivery-protocols": ["http/1.1"]}}],
       "my-default-networkmap.pid": "pid3"
     }
   }
 }
]]>
            </artwork>
          </figure>
        </section>

        <section title="Incremental Updates Example">
          <t>
            In this example, the client is interested in updates for the
            properties "cdni-fci-capabilities" and "pid" of two footprints
            "ipv4:192.0.2.0/24" and "countrycode:fr".
          </t>

          <figure>
            <artwork>
              <![CDATA[
  POST /updates/properties HTTP/1.1
  Host: alto.example.com
  Accept: text/event-stream,application/alto-error+json
  Content-Type: application/alto-updatestreamparams+json
  Content-Length: 341

  { "add": {
      "fci-propmap-stream": {
        "resource-id": "filtered-cdnifci-property-map",
        "input": {
          "properties": [ "my-default-cdnifci.cdni-fci-capabilities",
                          "my-default-networkmap.pid" ],
          "entities": [ "ipv4:192.0.2.0/24",
                        "ipv6:2001:db8::/32" ]
        }
      }
    }
  }

  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/event-stream

  event: application/alto-updatestreamcontrol+json
  data: {"control-uri":
  data: "https://alto.example.com/updates/streams/1414213562373"}

  event: application/alto-cdnifci+json,fci-propmap-stream
  data: { ... filtered property map ... }

  event: application/merge-patch+json,fci-propmap-stream
  data: {
  data:   "property-map": {
  data:     "meta": {
  data:       "dependent-vtags": [
  data:         { "resource-id": "my-default-cdnifci",
  data:           "tag": "2beeac8ee23c3dd1e98a73fd30df80ece9fa5627"},
  data:         { "resource-id": "my-default-networkmap",
  data:           "tag": "7915dc0290c2705481c491a2b4ffbec482b3cf63"}
  data:       ]
  data:     },
  data:     "ipv4:192.0.2.0/24": {
  data:       "my-default-cdnifci.cdni-fci-capabilities": [
  data:         { "capability-type": "FCI.DeliveryProtocol",
  data:           "capability-value": {
  data:             "delivery-protocols": ["http/1.1", "https/1.1"]}}]
  data:     }
  data:   }
  data: }

  event: application/json-patch+json,fci-propmap-stream
  data: [
  data:   { "op": "replace",
  data:     "path": "/meta/dependent-vtags/0/tag",
  data:     "value": "61b23185a50dc7b334577507e8f00ff8c3b409e4"
  data:   },
  data:   { "op": "replace",
  data:     "path":
  data:     "/property-map/countrycode:fr/my-default-networkmap.pid",
  data:     "value": "pid5"
  data:   }
  data: ]
]]>
            </artwork>
          </figure>
        </section>

      </section>

    </section>

    <section title="IANA Considerations" anchor="iana">
      <section title="CDNI Metadata Footprint Type Registry">
        <t>
          As proposed in Section 7.2 of <xref target="RFC8006"/>, "CDNI
          Metadata Footprint Types" registry is requested. A new footprint
          type is to be registered, listed in <xref
          target="tbl:footprint-type" pageno="false" format="default"/>.
        </t>

        <texttable title="CDNI Metadata Footprint Type" anchor="tbl:footprint-type" style="full">
          <ttcol>Footprint Type</ttcol>
          <ttcol>Description</ttcol>
          <ttcol>Specification</ttcol>
          <c>altopid</c>
          <c>A list of PID-names</c>
          <c>Section 4 of RFCthis</c>
        </texttable>
        <t>
          [RFC Editor: Please replace RFCthis with the published RFC number
          for this document.]
        </t>

      </section>

      <section title="ALTO Entity Domain Type Registry">
        <t>
          As proposed in Section 11.2 of <xref
          target="I-D.ietf-alto-unified-props-new"/>, "ALTO Entity Domain
          Type Registry" is requested. Two new entity domain types are to be
          registered, listed in <xref target="tbl:entity-domain"
          pageno="false" format="default"/>.
        </t>

        <texttable title="ALTO Entity Domain Types" anchor="tbl:entity-domain" style="full">
          <ttcol>Identifier</ttcol>
          <ttcol>Entity Address Encoding</ttcol>
          <ttcol>Hierarchy &amp; Inheritance</ttcol>
          <c>asn</c>
          <c>
            See <xref target="asn-entity-id"/>
          </c>
          <c>None</c>
          <c>countrycode</c>
          <c>
            See <xref target="countrycode-entity-id"/>
          </c>
          <c>None</c>
        </texttable>
      </section>

      <section title="ALTO Entity Property Type Registry">
        <t>
          As proposed in Section 11.3 of <xref
          target="I-D.ietf-alto-unified-props-new"/>, "ALTO Entity Property
          Type Registry" is required. A new entity property type is to be
          registered, listed in <xref target="tbl:prop-type-register"
          pageno="false" format="default"/>.
        </t>

        <texttable title="ALTO CDNI FCI Property Type" anchor="tbl:prop-type-register" style="full">
          <ttcol>Identifier</ttcol>
          <ttcol>Intended Semantics</ttcol>
          <c>cdni-fci-capabilities</c>
          <c>An array of CDNI FCI capability objects</c>
        </texttable>
      </section>

    </section>

    <section title="Security Considerations" anchor="security">
      <t>
        As an extension of the base ALTO protocol (<xref target="RFC7285"/>),
        this document fits into the architecture of the base protocol. And
        hence Security Considerations of the base protocol (Section 15 of
        <xref target="RFC7285"/>) fully apply when this extension is
        provided by an ALTO server.
      </t>

      <t>
        In the context of CDNI FCI, additional security considerations should
        be included as follows:
      </t>

      <t>
        <list style="symbols">
          <t>
            For authenticity and integrity of ALTO information, an attacker
            may disguise itself as an ALTO server for a dCDN, and provide
            false capabilities and footprints to a uCDN using the CDNI FCI
            service. Such false information may lead a uCDN to (1) select an
            incorrect dCDN to serve user requests, or (2) skip uCDNs in good
            conditions.
          </t>

          <t>
            For potential undesirable guidance from authenticated ALTO
            information, a dCDN can provide a uCDN with limited capabilities
            and smaller footprint coverage so that the dCDN can avoid
            transferring traffic for a uCDN which they should have to
            transfer.
          </t>

          <t>
            For confidentiality and privacy of ALTO information, footprint
            properties integrated with ALTO unified property may expose
            network location identifiers (e.g., IP addresses or fine-grained
            PIDs).
          </t>

          <t>
            For availability of ALTO services, an attacker may conduct
            service degradation attacks using services defined in this
            document to disable ALTO services of a network. It may request
            potentially large, full CDNI FCI resources from an ALTO server in
            a dCDN continuously, to consume the bandwidth resources of that
            ALTO server. It may also query filtered property map services
            with many smaller individual footprints, to consume the
            computation resources of the ALTO server.
          </t>
        </list>
      </t>

      <t>
        Although protection strategies as described in Section 15 of <xref
        target="RFC7285"/> should be applied to address aforementioned
        security considerations, one additional information leakage risk
        introduced by this document could not be addressed by these
        strategies. In particular, if a dCDN signs agreements with multiple
        uCDNs without any isolation, this dCDN may disclose extra information
        of one uCDN to another one. In that case, one uCDN may redirect
        requests which should not have to be served by this dCDN to it.
      </t>

      <t>
        To reduce the risk, a dCDN should isolate full/filtered CDNI FCI
        resources for different uCDNs. It could consider generating URIs of
        different full/filtered CDNI FCI resources by hashing its company ID,
        a uCDN's company ID as well as their agreements. A dCDN should avoid
        exposing all full/filtered CDNI FCI resources in one of its IRDs.
      </t>

    </section>

    <section title="Acknowledgments" anchor="ack">
      <t>
        The authors thank Matt Caulfield, Danny Alex Lachos Perez, Daryl
        Malas and Sanjay Mishra for their timely reviews and invaluable
        comments.
      </t>

      <t>
        Jan Seedorf is partially supported by the GreenICN project (GreenICN:
        Architecture and Applications of Green Information Centric
        Networking), a research project supported jointly by the European
        Commission under its 7th Framework Program (contract no. 608518) and
        the National Institute of Information and Communications Technology
        (NICT) in Japan (contract no. 167). The views and conclusions
        contained herein are those of the authors and should not be
        interpreted as necessarily representing the official policies or
        endorsements, either expressed or implied, of the GreenICN project,
        the European Commission, or NICT.
      </t>
    </section>

    <section title="Contributors">
      <t>
        Mr. Xiao Shawn Lin is an author of an early version of this document,
        with many contributions.
      </t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      <reference anchor="ISO3166-1">
        <front>
          <title>Codes for the representation of names of countries and their subdivisions -- Part 1: Country codes</title>
          <author>
            <organization>The International Organization for Standardization</organization>
          </author>

          <date year="2013" />
        </front>

        <seriesInfo name="ISO" value="3166-1:2013" />
      </reference>
      &RFC5693;
      &RFC6707;
      &RFC6793;
      &RFC7285;
      &RFC8006;
      &RFC8008;
    </references>
    <references title="Informative References">
      &I-D.ietf-alto-incr-update-sse;
      &I-D.ietf-alto-path-vector;
      &I-D.ietf-alto-unified-props-new;
      &RFC7336;
      &RFC7975;
    </references>
  </back>
</rfc>
